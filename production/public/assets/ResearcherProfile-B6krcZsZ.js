import{c as z,r as h,b as xe,j as e,C as F,d as E,S as qe,f as Ye,g as We,t as Ge,v as Qe,w as he,x as fe,y as ge,P as be,z as M,D as je,E as Be,F as He,H as Ke,J as Ve,K as Xe,M as Je,N as Ze,O as et,e as P,p as tt,a as ee,B as st,I as at,Q as rt,U as it,T as nt,V as le,W as ye,u as ot,i as lt,n as ct}from"./index-DsMkGSNQ.js";import{g as dt,A as B,X as we,Y as H,f as mt,E as ve,R as ut,C as pt,T as xt,L as ht,a as ft,b as Ne,Q as gt,c as Ce,F as bt,N as Q,S as jt,d as yt,e as wt,h as $,P as vt,i as Nt,j as Ct,M as kt}from"./index-DEuNjv6k.js";import{S as ce}from"./skeleton-LtVR_Qyf.js";import{A as ke}from"./award-Bbq7CScr.js";import{T as Pt}from"./trending-up-DG00uB7J.js";import{F as Y}from"./file-text-7bLv6ELf.js";import{h as St,R as Rt,u as _t,F as At}from"./Combination-CJn4SfTu.js";import{u as Ot}from"./index-DCOyCOZG.js";import{u as Pe,n as Se,P as Tt,g as It}from"./ThemeContext-BZiRlJwr.js";import{P as de}from"./palette-B8tr1z9j.js";import{D as te,a as se,b as ae,c as W,d as G,e as K,f as me}from"./dialog-Dnm1RwJp.js";import{Q as V}from"./qr-code-ymSEqRGv.js";import{D as X}from"./download-Dl1CezvS.js";import{M as Ft}from"./mail-D8dE7q13.js";import{u as Et}from"./useMutation-BIiySL2y.js";import{T as Lt}from"./textarea-jlxMfcOq.js";import{L as q}from"./label-DBXjDKEQ.js";import{R as Ut,a as $t}from"./radio-group-CxRozOAg.js";import{C as Mt}from"./circle-check-big-DF4jmYxg.js";import{E as J}from"./external-link-By5JbUa5.js";import{B as Re}from"./building-2-9xxmfo6u.js";import{U as zt}from"./user-CON3jPQo.js";import"./select-Bw0sBznx.js";import"./index-CwynGiMj.js";import"./separator-MX7n0DGa.js";import"./star-BbXoLBND.js";import"./database-DDzPeMy7.js";import"./index-B_Ogmu_i.js";import"./circle-nf2uHJvD.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=z("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=z("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=z("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=z("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=z("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var Yt=dt({chartName:"AreaChart",GraphicalChild:B,axisComponents:[{axisType:"xAxis",AxisComp:we},{axisType:"yAxis",AxisComp:H}],formatAxisMap:mt});function Wt(){if(typeof window>"u")return{primary:"#1e3a5f",accent:"#c9a227",primaryLight:"#2a4d6e"};const a=getComputedStyle(document.documentElement);return{primary:a.getPropertyValue("--theme-primary").trim()||"#1e3a5f",accent:a.getPropertyValue("--theme-accent").trim()||"#c9a227",primaryLight:a.getPropertyValue("--theme-primary").trim()||"#1e3a5f"}}function Gt({openalexId:a,researcherData:o,inline:i=!1}){var p,v,j;const t=h.useMemo(()=>Wt(),[]),{data:m,isLoading:c}=xe({queryKey:[`/api/researcher/${a}/data`],retry:!1,enabled:!o}),l=o||m,d=h.useMemo(()=>{var N,_;const u=l==null?void 0:l.researcher,b=(u==null?void 0:u.counts_by_year)||[];if(b.length===0){const g=(l==null?void 0:l.publications)||[];if(g.length===0)return{data:[],milestones:[],careerStart:null,peakYear:null,totalYears:0,avgPubsPerYear:0};const x={};g.forEach(A=>{const R=A.publicationYear||new Date().getFullYear();x[R]||(x[R]={works:0,citations:0}),x[R].works+=1,x[R].citations+=A.citationCount||0});const C=Object.keys(x).map(Number).sort((A,R)=>A-R),k=Math.min(...C),I=Math.max(...C),U=[];let ne=0,oe=0;for(let A=k;A<=I;A++){const R=x[A]||{works:0,citations:0};ne+=R.works,oe+=R.citations,U.push({year:A,publications:R.works,citations:R.citations,cumulativePublications:ne,cumulativeCitations:oe})}return s(U,k,I)}const y=[...b].sort((g,x)=>g.year-x.year),n=(N=y[0])==null?void 0:N.year,f=(_=y[y.length-1])==null?void 0:_.year,w=[];let O=0,S=0;for(let g=n;g<=f;g++){const x=y.find(I=>I.year===g),C=(x==null?void 0:x.works_count)||0,k=(x==null?void 0:x.cited_by_count)||0;O+=C,S+=k,w.push({year:g,publications:C,citations:k,cumulativePublications:O,cumulativeCitations:S})}return s(w,n,f)},[l]);function s(u,b,y){if(u.length===0)return{data:[],milestones:[],careerStart:null,peakYear:null,totalYears:0,avgPubsPerYear:0};const n=[],f=u.find(g=>g.publications>0);f&&n.push({year:f.year,type:"first_publication",label:"Career Start"});const w=u.reduce((g,x)=>x.publications>((g==null?void 0:g.publications)||0)?x:g,u[0]);w&&w.publications>0&&n.push({year:w.year,type:"peak_year",label:`Peak Year (${w.publications} pubs)`,value:w.publications}),[100,500,1e3,5e3,1e4].forEach(g=>{const x=u.find(k=>k.cumulativeCitations>=g),C=u.find(k=>k.year===(x==null?void 0:x.year)-1);x&&(!C||C.cumulativeCitations<g)&&n.push({year:x.year,type:"citation_milestone",label:`${g.toLocaleString()} Citations`,value:g})});const S=u.reduce((g,x)=>g+x.publications,0),N=y-b+1,_=N>0?(S/N).toFixed(1):0;return{data:u,milestones:n.slice(0,4),careerStart:b,peakYear:w==null?void 0:w.year,totalYears:N,avgPubsPerYear:_}}const r=({active:u,payload:b,label:y})=>{if(u&&b&&b.length){const n=b[0].payload,f=t;return e.jsxs("div",{className:"bg-background/95 backdrop-blur-sm border border-border rounded-lg shadow-lg p-3 text-sm",children:[e.jsx("p",{className:"font-semibold text-foreground mb-2",children:y}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f.primary}}),e.jsx("span",{className:"text-muted-foreground",children:"Publications:"}),e.jsx("span",{className:"font-medium",children:n.publications}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(total: ",n.cumulativePublications,")"]})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f.accent}}),e.jsx("span",{className:"text-muted-foreground",children:"Citations:"}),e.jsx("span",{className:"font-medium",children:n.citations.toLocaleString()}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(total: ",n.cumulativeCitations.toLocaleString(),")"]})]})]})]})}return null};return c?e.jsxs("div",{"data-testid":"section-timeline-loading",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:[...Array(4)].map((u,b)=>e.jsx(ce,{className:"h-20 flex-1 rounded-lg"},b))}),e.jsx(ce,{className:"h-[280px] w-full rounded-lg"})]}):d.data.length===0?e.jsx(ve,{"data-testid":"section-timeline-empty",icon:Z,title:"No Timeline Data",description:"Career timeline will appear once publication data is available."}):e.jsxs("div",{"data-testid":"section-career-timeline",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(F,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Career Span"})]}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[d.totalYears," years"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[d.careerStart," ‚Äì ",(p=d.data[d.data.length-1])==null?void 0:p.year]})]})}),d.peakYear&&e.jsx(F,{className:"bg-gradient-to-br from-accent/5 to-accent/10 border-accent/20",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ke,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Peak Year"})]}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:d.peakYear}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Most productive year"})]})}),e.jsx(F,{className:"bg-gradient-to-br from-emerald-500/5 to-emerald-500/10 border-emerald-500/20",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pt,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Avg/Year"})]}),e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:d.avgPubsPerYear}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Publications per year"})]})}),d.milestones.length>1&&e.jsx(F,{className:"bg-gradient-to-br from-purple-500/5 to-purple-500/10 border-purple-500/20",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(qe,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Milestone"})]}),e.jsx("p",{className:"text-lg font-bold text-purple-600 leading-tight",children:(v=d.milestones[d.milestones.length-1])==null?void 0:v.label}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["in ",(j=d.milestones[d.milestones.length-1])==null?void 0:j.year]})]})})]}),e.jsx(F,{children:e.jsxs(E,{className:"p-4 md:p-6",children:[e.jsx("div",{className:"h-[280px] md:h-[320px]",children:e.jsx(ut,{width:"100%",height:"100%",children:e.jsxs(Yt,{data:d.data,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"pubGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:t.primary,stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:t.primary,stopOpacity:.05})]}),e.jsxs("linearGradient",{id:"citeGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:t.accent,stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:t.accent,stopOpacity:.05})]})]}),e.jsx(pt,{strokeDasharray:"3 3",className:"stroke-muted",opacity:.3}),e.jsx(we,{dataKey:"year",tick:{fontSize:11,fill:"currentColor"},tickLine:!1,axisLine:{stroke:"currentColor",opacity:.2},interval:"preserveStartEnd"}),e.jsx(H,{yAxisId:"left",tick:{fontSize:11,fill:"currentColor"},tickLine:!1,axisLine:{stroke:"currentColor",opacity:.2},width:35,label:{value:"Publications",angle:-90,position:"insideLeft",style:{fontSize:10,fill:t.primary}}}),e.jsx(H,{yAxisId:"right",orientation:"right",tick:{fontSize:11,fill:"currentColor"},tickLine:!1,axisLine:{stroke:"currentColor",opacity:.2},width:45,tickFormatter:u=>u>=1e3?`${(u/1e3).toFixed(0)}k`:u,label:{value:"Citations",angle:90,position:"insideRight",style:{fontSize:10,fill:t.accent}}}),e.jsx(xt,{content:e.jsx(r,{})}),e.jsx(ht,{verticalAlign:"top",height:36,formatter:u=>e.jsx("span",{className:"text-sm text-foreground",children:u})}),d.milestones.filter(u=>u.type==="first_publication"||u.type==="peak_year").map((u,b)=>e.jsx(ft,{x:u.year,yAxisId:"left",stroke:u.type==="first_publication"?"#22c55e":"#f59e0b",strokeDasharray:"5 5",strokeWidth:1.5,label:{value:u.type==="first_publication"?"üöÄ":"‚≠ê",position:"top",fontSize:14}},b)),e.jsx(B,{yAxisId:"left",type:"monotone",dataKey:"publications",name:"Publications",stroke:t.primary,strokeWidth:2,fill:"url(#pubGradient)",dot:!1,activeDot:{r:4,fill:t.primary}}),e.jsx(B,{yAxisId:"right",type:"monotone",dataKey:"citations",name:"Citations",stroke:t.accent,strokeWidth:2,fill:"url(#citeGradient)",dot:!1,activeDot:{r:4,fill:t.accent}})]})})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"üöÄ Career start ‚Ä¢ ‚≠ê Peak productivity year ‚Ä¢ Data from OpenAlex"})})]})})]})}function Qt(a){switch(a){case"research_interests":return e.jsx(Ne,{className:"w-5 h-5"});case"awards":return e.jsx(ke,{className:"w-5 h-5"});case"teaching":return e.jsx(Ge,{className:"w-5 h-5"});case"grants":return e.jsx(Dt,{className:"w-5 h-5"});default:return e.jsx(Y,{className:"w-5 h-5"})}}function Bt(a){switch(a){case"research_interests":return{bg:"bg-blue-500/10",text:"text-blue-600",border:"border-blue-500/20"};case"awards":return{bg:"bg-amber-500/10",text:"text-amber-600",border:"border-amber-500/20"};case"teaching":return{bg:"bg-green-500/10",text:"text-green-600",border:"border-green-500/20"};case"grants":return{bg:"bg-purple-500/10",text:"text-purple-600",border:"border-purple-500/20"};default:return{bg:"bg-slate-500/10",text:"text-slate-600",border:"border-slate-500/20"}}}function Ht(a){return a.split(`
`).map((i,t)=>{if(i.startsWith("### "))return e.jsx("h4",{className:"font-semibold text-lg mt-4 mb-2",children:i.slice(4)},t);if(i.startsWith("## "))return e.jsx("h3",{className:"font-semibold text-xl mt-4 mb-2",children:i.slice(3)},t);if(i.startsWith("# "))return e.jsx("h2",{className:"font-bold text-2xl mt-4 mb-2",children:i.slice(2)},t);if(i.startsWith("- ")||i.startsWith("* "))return e.jsx("li",{className:"ml-4 list-disc text-muted-foreground",children:i.slice(2)},t);const m=i.match(/^\d+\.\s/);if(m)return e.jsx("li",{className:"ml-4 list-decimal text-muted-foreground",children:i.slice(m[0].length)},t);if(i.trim()==="")return e.jsx("br",{},t);const c=i.split(/(\*\*.*?\*\*|\*.*?\*|_.*?_)/g);return e.jsx("p",{className:"text-muted-foreground mb-2",children:c.map((l,d)=>l.startsWith("**")&&l.endsWith("**")?e.jsx("strong",{children:l.slice(2,-2)},d):l.startsWith("*")&&l.endsWith("*")||l.startsWith("_")&&l.endsWith("_")?e.jsx("em",{children:l.slice(1,-1)},d):l)},t)})}function Kt({sections:a}){if(!a||a.length===0)return null;const o=[...a].sort((i,t)=>i.sortOrder-t.sortOrder);return e.jsx("section",{className:"py-12 bg-muted/30",id:"about",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:o.map(i=>{const t=Bt(i.sectionType);return e.jsxs(F,{className:`border ${t.border} shadow-sm hover:shadow-md transition-shadow`,children:[e.jsx(Ye,{className:"pb-3",children:e.jsxs(We,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:`w-10 h-10 ${t.bg} rounded-lg flex items-center justify-center ${t.text}`,children:Qt(i.sectionType)}),e.jsx("span",{children:i.title})]})}),e.jsx(E,{children:e.jsx("div",{className:"prose prose-sm max-w-none",children:Ht(i.content)})})]},i.id)})})})})}var re="Popover",[Ae,Ks]=Qe(re,[he]),D=he(),[Vt,T]=Ae(re),Oe=a=>{const{__scopePopover:o,children:i,open:t,defaultOpen:m,onOpenChange:c,modal:l=!1}=a,d=D(o),s=h.useRef(null),[r,p]=h.useState(!1),[v=!1,j]=Je({prop:t,defaultProp:m,onChange:c});return e.jsx(Ze,{...d,children:e.jsx(Vt,{scope:o,contentId:Ot(),triggerRef:s,open:v,onOpenChange:j,onOpenToggle:h.useCallback(()=>j(u=>!u),[j]),hasCustomAnchor:r,onCustomAnchorAdd:h.useCallback(()=>p(!0),[]),onCustomAnchorRemove:h.useCallback(()=>p(!1),[]),modal:l,children:i})})};Oe.displayName=re;var Te="PopoverAnchor",Xt=h.forwardRef((a,o)=>{const{__scopePopover:i,...t}=a,m=T(Te,i),c=D(i),{onCustomAnchorAdd:l,onCustomAnchorRemove:d}=m;return h.useEffect(()=>(l(),()=>d()),[l,d]),e.jsx(fe,{...c,...t,ref:o})});Xt.displayName=Te;var Ie="PopoverTrigger",Fe=h.forwardRef((a,o)=>{const{__scopePopover:i,...t}=a,m=T(Ie,i),c=D(i),l=ge(o,m.triggerRef),d=e.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":m.open,"aria-controls":m.contentId,"data-state":Me(m.open),...t,ref:l,onClick:M(a.onClick,m.onOpenToggle)});return m.hasCustomAnchor?d:e.jsx(fe,{asChild:!0,...c,children:d})});Fe.displayName=Ie;var ie="PopoverPortal",[Jt,Zt]=Ae(ie,{forceMount:void 0}),Ee=a=>{const{__scopePopover:o,forceMount:i,children:t,container:m}=a,c=T(ie,o);return e.jsx(Jt,{scope:o,forceMount:i,children:e.jsx(je,{present:i||c.open,children:e.jsx(Ve,{asChild:!0,container:m,children:t})})})};Ee.displayName=ie;var L="PopoverContent",Le=h.forwardRef((a,o)=>{const i=Zt(L,a.__scopePopover),{forceMount:t=i.forceMount,...m}=a,c=T(L,a.__scopePopover);return e.jsx(je,{present:t||c.open,children:c.modal?e.jsx(ts,{...m,ref:o}):e.jsx(ss,{...m,ref:o})})});Le.displayName=L;var es=Xe("PopoverContent.RemoveScroll"),ts=h.forwardRef((a,o)=>{const i=T(L,a.__scopePopover),t=h.useRef(null),m=ge(o,t),c=h.useRef(!1);return h.useEffect(()=>{const l=t.current;if(l)return St(l)},[]),e.jsx(Rt,{as:es,allowPinchZoom:!0,children:e.jsx(Ue,{...a,ref:m,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:M(a.onCloseAutoFocus,l=>{var d;l.preventDefault(),c.current||(d=i.triggerRef.current)==null||d.focus()}),onPointerDownOutside:M(a.onPointerDownOutside,l=>{const d=l.detail.originalEvent,s=d.button===0&&d.ctrlKey===!0,r=d.button===2||s;c.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:M(a.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),ss=h.forwardRef((a,o)=>{const i=T(L,a.__scopePopover),t=h.useRef(!1),m=h.useRef(!1);return e.jsx(Ue,{...a,ref:o,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:c=>{var l,d;(l=a.onCloseAutoFocus)==null||l.call(a,c),c.defaultPrevented||(t.current||(d=i.triggerRef.current)==null||d.focus(),c.preventDefault()),t.current=!1,m.current=!1},onInteractOutside:c=>{var s,r;(s=a.onInteractOutside)==null||s.call(a,c),c.defaultPrevented||(t.current=!0,c.detail.originalEvent.type==="pointerdown"&&(m.current=!0));const l=c.target;((r=i.triggerRef.current)==null?void 0:r.contains(l))&&c.preventDefault(),c.detail.originalEvent.type==="focusin"&&m.current&&c.preventDefault()}})}),Ue=h.forwardRef((a,o)=>{const{__scopePopover:i,trapFocus:t,onOpenAutoFocus:m,onCloseAutoFocus:c,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:s,onFocusOutside:r,onInteractOutside:p,...v}=a,j=T(L,i),u=D(i);return _t(),e.jsx(At,{asChild:!0,loop:!0,trapped:t,onMountAutoFocus:m,onUnmountAutoFocus:c,children:e.jsx(Be,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:p,onEscapeKeyDown:d,onPointerDownOutside:s,onFocusOutside:r,onDismiss:()=>j.onOpenChange(!1),children:e.jsx(He,{"data-state":Me(j.open),role:"dialog",id:j.contentId,...u,...v,ref:o,style:{...v.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),$e="PopoverClose",as=h.forwardRef((a,o)=>{const{__scopePopover:i,...t}=a,m=T($e,i);return e.jsx(be.button,{type:"button",...t,ref:o,onClick:M(a.onClick,()=>m.onOpenChange(!1))})});as.displayName=$e;var rs="PopoverArrow",is=h.forwardRef((a,o)=>{const{__scopePopover:i,...t}=a,m=D(i);return e.jsx(Ke,{...m,...t,ref:o})});is.displayName=rs;function Me(a){return a?"open":"closed"}var ns=Oe,os=Fe,ls=Ee,ze=Le;const cs=ns,ds=os,De=h.forwardRef(({className:a,align:o="center",sideOffset:i=4,...t},m)=>e.jsx(ls,{children:e.jsx(ze,{ref:m,align:o,sideOffset:i,className:et("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",a),...t})}));De.displayName=ze.displayName;function ms({isPreview:a=!1}){const{themes:o,currentTheme:i,setCurrentTheme:t,isLoading:m}=Pe();return m||o.length===0?null:e.jsx("div",{className:`fixed ${a?"bottom-36 md:bottom-6":"bottom-20 md:bottom-6"} right-4 md:right-6 z-40`,children:e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsx(P,{size:"lg",className:"rounded-full shadow-lg hover:shadow-xl transition-all duration-300 h-14 w-14",style:{backgroundColor:Se(i==null?void 0:i.config).colors.primary},"data-testid":"button-theme-switcher",children:e.jsx(de,{className:"h-6 w-6 text-white"})})}),e.jsx(De,{className:"w-72 p-4",side:"top",align:"end",sideOffset:12,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Choose Theme"})]}),e.jsx("div",{className:"grid gap-2",children:o.map(c=>e.jsx(us,{theme:c,isSelected:(i==null?void 0:i.id)===c.id,onSelect:()=>t(c)},c.id))}),a&&e.jsx("p",{className:"text-xs text-muted-foreground pt-2 border-t",children:"Preview different themes. Your preference will be saved when you sign up."})]})})]})})}function us({theme:a,isSelected:o,onSelect:i}){const t=Se(a.config);return e.jsxs("button",{onClick:i,className:`
        w-full flex items-center gap-3 p-3 rounded-lg border transition-all duration-200
        ${o?"border-primary bg-primary/5 ring-1 ring-primary":"border-border hover:border-primary/50 hover:bg-muted/50"}
      `,"data-testid":`button-theme-${a.name.toLowerCase().replace(/\s+/g,"-")}`,children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-white/20",style:{backgroundColor:t.colors.primary}}),e.jsx("div",{className:"w-5 h-5 rounded-full border border-white/20 -ml-2",style:{backgroundColor:t.colors.accent}})]}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:a.name}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:a.description})]}),o&&e.jsx(tt,{className:"h-4 w-4 text-primary shrink-0"})]})}function ps({openalexId:a,name:o,title:i,institution:t,publicationCount:m,citationCount:c,profileUrl:l}){const[d,s]=h.useState(!1),[r,p]=h.useState(!1),v=h.useRef(null),{toast:j}=ee(),u=`/api/researcher/${a}/qr-code?url=${encodeURIComponent(l||window.location.href)}`,b=async()=>{p(!0);try{const y=document.createElement("canvas"),n=y.getContext("2d");if(!n)throw new Error("Canvas not supported");const f=400,w=500;y.width=f,y.height=w,n.fillStyle="#0B1F3A",n.fillRect(0,0,f,w),n.fillStyle="rgba(255, 255, 255, 0.05)",n.beginPath(),n.arc(f+50,-50,200,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(-50,w+50,150,0,Math.PI*2),n.fill(),n.fillStyle="#FFFFFF",n.font="bold 24px Inter, system-ui, sans-serif",n.textAlign="center";const O=o.length>25?o.substring(0,22)+"...":o;if(n.fillText(O,f/2,50),i){n.font="14px Inter, system-ui, sans-serif",n.fillStyle="rgba(255, 255, 255, 0.8)";const x=i.length>35?i.substring(0,32)+"...":i;n.fillText(x,f/2,75)}if(t){n.font="12px Inter, system-ui, sans-serif",n.fillStyle="rgba(255, 255, 255, 0.6)";const x=t.length>40?t.substring(0,37)+"...":t;n.fillText(x,f/2,95)}const S=new Image;S.crossOrigin="anonymous",await new Promise((x,C)=>{S.onload=()=>{const I=(f-150)/2,U=120;n.fillStyle="#FFFFFF",n.beginPath(),n.roundRect(I-10,U-10,170,170,12),n.fill(),n.drawImage(S,I,U,150,150),x()},S.onerror=C,S.src=u});const N=310;n.fillStyle="rgba(255, 255, 255, 0.1)",n.beginPath(),n.roundRect(30,N,160,70,8),n.fill(),n.beginPath(),n.roundRect(210,N,160,70,8),n.fill(),n.textAlign="center",n.fillStyle="#F2994A",n.font="bold 28px Inter, system-ui, sans-serif",n.fillText(m.toLocaleString(),110,N+35),n.fillText(c.toLocaleString(),290,N+35),n.fillStyle="rgba(255, 255, 255, 0.7)",n.font="11px Inter, system-ui, sans-serif",n.fillText("Publications",110,N+55),n.fillText("Citations",290,N+55),n.fillStyle="rgba(255, 255, 255, 0.5)",n.font="11px Inter, system-ui, sans-serif",n.fillText("Scan to view full research profile",f/2,420),n.fillStyle="rgba(255, 255, 255, 0.3)",n.font="10px Inter, system-ui, sans-serif",n.fillText("scholar.name",f/2,w-20);const _=y.toDataURL("image/png"),g=document.createElement("a");g.download=`${o.replace(/\s+/g,"-").toLowerCase()}-research-passport.png`,g.href=_,g.click(),j({title:"Download complete",description:"Your Research Passport has been saved"})}catch(y){console.error("Download error:",y),j({title:"Download failed",description:"Please try again",variant:"destructive"})}finally{p(!1)}};return e.jsxs(te,{open:d,onOpenChange:s,children:[e.jsx(se,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-white/15 hover:bg-white/25 transition-colors text-sm font-medium text-white","data-testid":"button-research-passport",children:[e.jsx(V,{className:"w-3.5 h-3.5"}),"Passport"]})}),e.jsxs(ae,{className:"sm:max-w-md",children:[e.jsx(W,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Research Passport"]})}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{ref:v,className:"w-full max-w-[320px] rounded-xl overflow-hidden shadow-2xl",style:{background:"linear-gradient(135deg, #0B1F3A 0%, #1a365d 100%)"},children:[e.jsxs("div",{className:"p-6 text-center text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-1 truncate",children:o}),i&&e.jsx("p",{className:"text-sm text-white/80 mb-1 truncate",children:i}),t&&e.jsx("p",{className:"text-xs text-white/60 truncate",children:t})]}),e.jsx("div",{className:"flex justify-center pb-4",children:e.jsx("div",{className:"bg-white p-3 rounded-xl",children:e.jsx("img",{src:u,alt:"QR Code",className:"w-32 h-32","data-testid":"img-passport-qr"})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 px-6 pb-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:e.jsx(st,{className:"w-3 h-3 text-amber-400"})}),e.jsx("p",{className:"text-2xl font-bold text-amber-400",children:m.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/70",children:"Publications"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:e.jsx(gt,{className:"w-3 h-3 text-amber-400"})}),e.jsx("p",{className:"text-2xl font-bold text-amber-400",children:c.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/70",children:"Citations"})]})]}),e.jsx("div",{className:"text-center pb-4",children:e.jsx("p",{className:"text-xs text-white/50",children:"Scan to view full profile"})}),e.jsx("div",{className:"bg-white/5 py-2 text-center",children:e.jsx("p",{className:"text-xs text-white/40",children:"scholar.name"})})]}),e.jsxs(P,{onClick:b,disabled:r,className:"w-full max-w-[320px] gap-2","data-testid":"button-download-passport",children:[e.jsx(X,{className:"h-4 w-4"}),r?"Generating...":"Download Passport"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center max-w-[280px]",children:"Use this card at conferences, on business cards, or in email signatures. Scan the QR code to view the full research profile."})]})]})]})}function xs({url:a,title:o,description:i,openalexId:t}){const[m,c]=h.useState(!1),[l,d]=h.useState(""),{toast:s}=ee(),r=a||window.location.href,p=`${o} - Research Profile`,v=i||`Check out ${o}'s research profile`,j=()=>{const f=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(r)}`;window.open(f,"_blank","width=600,height=600")},u=()=>{const f=`https://twitter.com/intent/tweet?text=${encodeURIComponent(v)}&url=${encodeURIComponent(r)}`;window.open(f,"_blank","width=600,height=600")},b=()=>{const f=encodeURIComponent(p),w=encodeURIComponent(`${v}

${r}`);window.location.href=`mailto:?subject=${f}&body=${w}`},y=async()=>{try{await navigator.clipboard.writeText(r),s({title:"Link copied!",description:"Profile URL copied to clipboard"})}catch{s({title:"Copy failed",description:"Please copy the URL manually",variant:"destructive"})}},n=async()=>{const f=`/api/researcher/${t}/qr-code?url=${encodeURIComponent(r)}`;d(f),c(!0)};return e.jsxs("div",{className:"flex flex-wrap gap-2","data-testid":"section-share-buttons",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:j,className:"gap-2","data-testid":"button-share-linkedin","aria-label":"Share on LinkedIn",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"LinkedIn"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:u,className:"gap-2","data-testid":"button-share-twitter","aria-label":"Share on Twitter",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Twitter"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:b,className:"gap-2","data-testid":"button-share-email","aria-label":"Share via Email",children:[e.jsx(Ft,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Email"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:y,className:"gap-2","data-testid":"button-copy-link","aria-label":"Copy link to clipboard",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Link"})]}),e.jsxs(te,{open:m,onOpenChange:c,children:[e.jsx(se,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",onClick:n,className:"gap-2","data-testid":"button-generate-qr","aria-label":"Generate QR code for profile",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"QR Code"})]})}),e.jsxs(ae,{className:"sm:max-w-md",children:[e.jsxs(W,{children:[e.jsx(G,{children:"QR Code for Profile"}),e.jsx(K,{children:"Scan this QR code to share the profile at conferences or on posters"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4 py-4",children:[l&&e.jsx("img",{src:l,alt:"QR Code for profile",className:"w-64 h-64 border rounded-lg","data-testid":"img-qr-code"}),e.jsx(P,{variant:"outline",onClick:()=>{const f=document.createElement("a");f.href=l,f.download=`${t}-qr-code.png`,f.click()},"data-testid":"button-download-qr",children:"Download QR Code"})]})]})]})]})}const hs=[{value:"wrong_person",label:"This isn't me / wrong person",icon:it,description:"Profile shows a different researcher"},{value:"wrong_publications",label:"Wrong publications listed",icon:Y,description:"Papers I didn't author are included"},{value:"missing_publications",label:"Missing publications",icon:Y,description:"My papers are not showing up"},{value:"wrong_affiliation",label:"Wrong affiliation",icon:Re,description:"Institution information is incorrect"},{value:"other",label:"Other issue",icon:nt,description:"Something else is wrong"}];function fs({openalexId:a,researcherName:o}){const{toast:i}=ee(),[t,m]=h.useState(!1),[c,l]=h.useState(""),[d,s]=h.useState(""),[r,p]=h.useState(""),[v,j]=h.useState(!1),u=Et({mutationFn:async n=>{const f=await fetch("/api/report-issue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!f.ok)throw new Error("Failed to submit report");return f.json()},onSuccess:()=>{j(!0)},onError:()=>{i({title:"Failed to submit",description:"Please try again or email us directly at support@scholar.name",variant:"destructive"})}}),b=()=>{if(!c||!d||!r){i({title:"Please fill all fields",description:"All fields are required to submit a report",variant:"destructive"});return}u.mutate({openalexId:a,issueType:c,email:d,description:r})},y=()=>{l(""),s(""),p(""),j(!1),m(!1)};return e.jsxs(te,{open:t,onOpenChange:m,children:[e.jsx(se,{asChild:!0,children:e.jsxs(P,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Report Issue"})]})}),e.jsx(ae,{className:"sm:max-w-lg",children:v?e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-4",children:e.jsx(Mt,{className:"w-8 h-8 text-green-600"})}),e.jsx(G,{className:"text-center",children:"Report Submitted"}),e.jsxs(K,{className:"text-center",children:["Thank you for letting us know. We'll review this within 24-48 hours and follow up at ",d,"."]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-medium mb-2",children:"What happens next?"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"We'll investigate the issue with OpenAlex data"}),e.jsx("li",{children:"If the issue is in source data, we'll guide you on how to request a correction"}),e.jsx("li",{children:"For profile-specific issues, we'll fix them directly"})]})]}),e.jsx(me,{children:e.jsx(P,{onClick:y,className:"w-full",children:"Close"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-amber-600"}),"Report a Data Issue"]}),e.jsx(K,{children:"Found incorrect information on this profile? Let us know and we'll investigate. Data comes from OpenAlex and may need correction at the source."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{children:"What's wrong?"}),e.jsx(Ut,{value:c,onValueChange:n=>l(n),className:"grid gap-2",children:hs.map(n=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($t,{value:n.value,id:n.value}),e.jsxs(q,{htmlFor:n.value,className:"flex items-center gap-2 cursor-pointer font-normal",children:[e.jsx(n.icon,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:n.label})]})]},n.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"email",children:"Your email (for follow-up)"}),e.jsx(at,{id:"email",type:"email",placeholder:"your@email.com",value:d,onChange:n=>s(n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"description",children:"Describe the issue"}),e.jsx(Lt,{id:"description",placeholder:c==="wrong_publications"?"List the titles or DOIs of papers that shouldn't be here...":c==="missing_publications"?"List the titles or DOIs of your missing papers...":"Please describe what's incorrect and what the correct information should be...",value:r,onChange:n=>p(n.target.value),className:"min-h-[100px]"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"text-blue-800 mb-2",children:e.jsx("strong",{children:"About data corrections:"})}),e.jsxs("p",{className:"text-blue-700 text-xs leading-relaxed",children:["Publication data is sourced from"," ",e.jsxs("a",{href:`https://openalex.org/authors/${a}`,target:"_blank",rel:"noopener noreferrer",className:"underline inline-flex items-center gap-0.5",children:["OpenAlex ",e.jsx(J,{className:"w-3 h-3"})]}),". For major data corrections, we may need to help you submit a request to OpenAlex directly."]})]})]}),e.jsxs(me,{children:[e.jsx(P,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(P,{onClick:b,disabled:u.isPending,children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Report"})]})]})})]})}function gs(){var d;const a=h.useRef(null),o=h.useRef(null),i=h.useRef(0),t=5,m=1e3,c=()=>{var s;if(((s=a.current)==null?void 0:s.readyState)!==EventSource.OPEN){console.log("Establishing SSE connection for real-time updates...");try{a.current=new EventSource("/api/events"),a.current.onopen=()=>{console.log("‚úÖ Real-time updates connected"),i.current=0},a.current.onmessage=r=>{try{const p=JSON.parse(r.data);"openalexId"in p?(console.log(`üîÑ Received ${p.updateType} update for researcher:`,p.openalexId),le.invalidateQueries({queryKey:[`/api/researcher/${p.openalexId}/data`]}),le.invalidateQueries({queryKey:["/api/researcher",p.openalexId]}),console.log(`‚ú® Frontend data refreshed for researcher: ${p.openalexId}`)):p.type==="connected"?console.log("üì° SSE connection established"):p.type}catch(p){console.error("Error parsing SSE message:",p)}},a.current.onerror=r=>{if(console.warn("‚ùå SSE connection error:",r),a.current&&(a.current.close(),a.current=null),i.current<t){const p=m*Math.pow(2,i.current);console.log(`üîÑ Reconnecting in ${p}ms (attempt ${i.current+1}/${t})`),o.current=setTimeout(()=>{i.current++,c()},p)}else console.error("üö´ Max reconnection attempts reached. Real-time updates disabled.")}}catch(r){console.error("Failed to establish SSE connection:",r)}}},l=()=>{o.current&&(clearTimeout(o.current),o.current=null),a.current&&(console.log("üîå Disconnecting real-time updates..."),a.current.close(),a.current=null)};return h.useEffect(()=>(c(),()=>{l()}),[]),{isConnected:((d=a.current)==null?void 0:d.readyState)===EventSource.OPEN,reconnect:()=>{l(),i.current=0,c()},disconnect:l}}const pe=async(a,o,i)=>{try{let t=localStorage.getItem("scholar_visitor_id");t||(t=crypto.randomUUID(),localStorage.setItem("scholar_visitor_id",t)),await fetch("/api/analytics/track",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({openalexId:a,eventType:o,eventTarget:i,visitorId:t,referrer:document.referrer||null})})}catch(t){console.debug("Analytics tracking failed:",t)}};function bs(a){if(!a)return"?";const o=a.split(" ").filter(Boolean);return o.length===1?o[0].charAt(0).toUpperCase():(o[0].charAt(0)+o[o.length-1].charAt(0)).toUpperCase()}function js(){var n,f,w,O,S,N,_,g;const{id:a}=ye(),[,o]=ot(),{themeConfig:i}=Pe();gs();const{data:t,isLoading:m,error:c}=xe({queryKey:[`/api/researcher/${a}/data`],retry:!1}),l=((n=t==null?void 0:t.profile)==null?void 0:n.openalexId)||a;h.useEffect(()=>{l&&!(t!=null&&t.isPreview)&&pe(l,"view")},[l,t==null?void 0:t.isPreview]);const d=h.useCallback((x,C)=>{l&&!(t!=null&&t.isPreview)&&pe(l,"click",x),C&&window.open(C,"_blank","noopener,noreferrer")},[l,t==null?void 0:t.isPreview]),s=t==null?void 0:t.profile,r=t==null?void 0:t.researcher,p=(s==null?void 0:s.openalexId)||a||"",v=s?`${s.displayName||(r==null?void 0:r.display_name)} - Research Profile`:"Research Profile",j=(s==null?void 0:s.bio)||(r?`${(s==null?void 0:s.displayName)||r.display_name} - ${(r==null?void 0:r.works_count)||0} publications, ${(r==null?void 0:r.cited_by_count)||0} citations, h-index: ${((f=r==null?void 0:r.summary_stats)==null?void 0:f.h_index)||0}`:"Research Profile Platform"),u=typeof window<"u"?window.location.href:"",b=(s==null?void 0:s.profileImageUrl)||"https://images.unsplash.com/photo-1582750433449-648ed127bb54?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&h=500",y=h.useMemo(()=>{var x,C;return s?{"@context":"https://schema.org","@type":"Person",name:s.displayName||(r==null?void 0:r.display_name),description:s.bio||`Researcher with ${(r==null?void 0:r.works_count)||0} publications`,jobTitle:s.title,affiliation:s.currentAffiliation?{"@type":"Organization",name:s.currentAffiliation}:void 0,url:u,image:b,email:s.contactEmail||void 0,alumniOf:(x=t==null?void 0:t.affiliations)==null?void 0:x.map(k=>({"@type":"Organization",name:k.institutionName})),knowsAbout:(C=t==null?void 0:t.topics)==null?void 0:C.slice(0,10).map(k=>k.displayName),sameAs:[`https://openalex.org/authors/${p}`,s.cvUrl].filter(Boolean)}:null},[s,r,t,u,b,p]);return m?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Q,{researcherName:"Loading..."}),e.jsxs("section",{className:"hero-banner min-h-[85vh] flex items-center relative",children:[e.jsx("div",{className:"hero-pattern"}),e.jsx("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 z-10",children:e.jsxs("div",{className:"lg:grid lg:grid-cols-12 lg:gap-12 items-center",children:[e.jsx("div",{className:"lg:col-span-4 flex justify-center lg:justify-start mb-12 lg:mb-0",children:e.jsxs("div",{className:"profile-image-container",children:[e.jsx("div",{className:"profile-image-glow"}),e.jsx("div",{className:"relative bg-white/10 backdrop-blur-sm rounded-full p-3 shadow-2xl",children:e.jsx("div",{className:"w-44 h-44 lg:w-56 lg:h-56 rounded-full border-4 border-white/30 shadow-2xl flex items-center justify-center bg-primary/20 animate-pulse",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/20"})})})]})}),e.jsxs("div",{className:"lg:col-span-8 text-center lg:text-left text-white space-y-8",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("div",{className:"h-16 lg:h-20 bg-white/20 rounded-lg mb-4 animate-pulse w-3/4 mx-auto lg:mx-0"}),e.jsx("div",{className:"h-8 bg-white/15 rounded-lg mb-4 animate-pulse w-1/2 mx-auto lg:mx-0"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center lg:justify-start gap-4",children:[e.jsx("div",{className:"h-6 bg-white/10 rounded-lg animate-pulse w-48"}),e.jsx("div",{className:"h-6 bg-white/10 rounded-lg animate-pulse w-24"})]})]})}),e.jsx("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-white/15 rounded animate-pulse w-full"}),e.jsx("div",{className:"h-4 bg-white/15 rounded animate-pulse w-5/6"}),e.jsx("div",{className:"h-4 bg-white/15 rounded animate-pulse w-4/6"})]})}),e.jsxs("div",{className:"flex flex-wrap justify-center lg:justify-start gap-4 pt-4",children:[e.jsx("div",{className:"h-14 bg-white/15 rounded-xl animate-pulse w-44"}),e.jsx("div",{className:"h-14 bg-white/20 rounded-xl animate-pulse w-48"}),e.jsx("div",{className:"h-14 bg-white/10 rounded-xl animate-pulse w-40"})]}),e.jsxs("div",{className:"flex items-center justify-center lg:justify-start gap-3 pt-4",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/60 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/60 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/60 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-white/70 text-sm font-medium",children:"Building your portfolio preview..."})]})]})]})})]}),e.jsx("section",{className:"py-16 bg-muted/30",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(x=>e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-sm border animate-pulse",children:[e.jsx("div",{className:"h-10 bg-muted rounded mb-2 w-16"}),e.jsx("div",{className:"h-4 bg-muted/60 rounded w-24"})]},x))})})})]}):c||!t||!t.profile?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Q,{researcherName:"Researcher Profile"}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20",children:e.jsx(ve,{icon:qt,title:"No Profile Available",description:"The researcher profile you're looking for doesn't exist or isn't public yet."})})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-0","data-testid":"page-researcher-profile",style:It(i),children:[e.jsx(lt,{title:v,description:j,image:b,url:u,author:(s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"Researcher",type:"profile",structuredData:y||void 0}),e.jsx(Q,{researcherName:(s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"Researcher"}),e.jsxs("section",{id:"overview",className:"hero-banner-compact py-10 md:py-16 relative",children:[e.jsx("div",{className:"hero-pattern"}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10",children:e.jsxs("div",{className:"flex flex-col items-center text-center text-white",children:[e.jsx("div",{className:"mb-5",children:s!=null&&s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:"Professional portrait",className:"w-28 h-28 sm:w-32 sm:h-32 md:w-36 md:h-36 rounded-full object-cover border-4 border-white/30 shadow-2xl","data-testid":"img-profile-photo"}):e.jsx("div",{className:"w-28 h-28 sm:w-32 sm:h-32 md:w-36 md:h-36 rounded-full border-4 border-white/30 shadow-2xl flex items-center justify-center bg-primary/20","data-testid":"img-profile-photo",children:e.jsx("span",{className:"text-4xl sm:text-5xl font-bold text-primary",children:bs((s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"")})})}),e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-2","data-testid":"text-display-name",children:(s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"Researcher Profile"}),e.jsx("p",{className:"text-base sm:text-lg text-white/90 mb-1","data-testid":"text-title",children:t!=null&&t.isPreview&&!(s!=null&&s.title)?e.jsx("span",{className:"italic opacity-70",children:"Professor of [Your Field]"}):(s==null?void 0:s.title)||"Research Professional"}),((s==null?void 0:s.currentAffiliation)||((O=(w=r==null?void 0:r.last_known_institutions)==null?void 0:w[0])==null?void 0:O.display_name)||(t==null?void 0:t.isPreview))&&e.jsxs("p",{className:"text-sm text-white/70 flex items-center gap-1.5 mb-4","data-testid":"text-affiliation",children:[e.jsx(Re,{className:"w-3.5 h-3.5"}),t!=null&&t.isPreview&&!(s!=null&&s.currentAffiliation)?e.jsx("span",{className:"italic",children:"Your Institution"}):(s==null?void 0:s.currentAffiliation)||((N=(S=r==null?void 0:r.last_known_institutions)==null?void 0:S[0])==null?void 0:N.display_name)||""]}),(s==null?void 0:s.bio)&&e.jsx("p",{className:"text-sm text-white/75 max-w-xl leading-relaxed mb-5 line-clamp-2",children:s.bio}),e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[(s==null?void 0:s.orcidUrl)&&e.jsx("a",{href:s.orcidUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors",title:"ORCID",children:e.jsx(jt,{className:"w-4 h-4"})}),(s==null?void 0:s.googleScholarUrl)&&e.jsx("a",{href:s.googleScholarUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors",title:"Google Scholar",children:e.jsx(yt,{className:"w-4 h-4"})}),(s==null?void 0:s.linkedinUrl)&&e.jsx("a",{href:s.linkedinUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors",title:"LinkedIn",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3",children:[s!=null&&s.cvUrl&&s.cvUrl!=="#cv-placeholder"?e.jsxs("a",{href:s.cvUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-white text-primary font-semibold text-sm hover:bg-white/90 transition-colors shadow-md",onClick:()=>d("cv_download"),"data-testid":"link-cv",children:[e.jsx(X,{className:"w-4 h-4"}),"Download CV"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-white/15 text-sm font-medium opacity-50 cursor-not-allowed",title:"CV available after claiming profile",children:[e.jsx(X,{className:"w-4 h-4"}),"Download CV"]}),e.jsxs("a",{href:`https://openalex.org/authors/${p}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-white/15 hover:bg-white/25 text-sm font-medium transition-colors",onClick:()=>d("openalex_profile"),children:[e.jsx(J,{className:"w-4 h-4"}),"OpenAlex Profile"]}),e.jsx(ps,{openalexId:p,name:(s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"Researcher",title:s==null?void 0:s.title,institution:(s==null?void 0:s.currentAffiliation)||((g=(_=r==null?void 0:r.last_known_institutions)==null?void 0:_[0])==null?void 0:g.display_name),publicationCount:(r==null?void 0:r.works_count)||0,citationCount:(r==null?void 0:r.cited_by_count)||0,profileUrl:typeof window<"u"?window.location.href:""})]})]})})]}),e.jsx("section",{className:"py-3 bg-muted/50 border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Share this profile:"}),e.jsx(xs,{url:u,title:(s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"Researcher",description:j,openalexId:p})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"hidden md:flex items-center gap-1",children:["Data from"," ",e.jsxs("a",{href:`https://openalex.org/authors/${p}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline inline-flex items-center gap-0.5",children:["OpenAlex ",e.jsx(J,{className:"w-3 h-3"})]}),(t==null?void 0:t.lastSynced)&&e.jsxs("span",{className:"text-muted-foreground/70",children:["¬∑ Updated ",new Date(t.lastSynced).toLocaleDateString()]})]}),e.jsx(fs,{openalexId:p,researcherName:(s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"Researcher"})]})]})})}),e.jsx(wt,{openalexId:p}),((t==null?void 0:t.isPreview)||(s==null?void 0:s.bio))&&e.jsx("section",{className:"py-8 md:py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx($,{id:"about",title:"About",icon:e.jsx(zt,{className:"w-5 h-5 md:w-6 md:h-6"}),defaultOpen:!0,mobileDefaultOpen:!0,children:e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-sm md:text-base text-muted-foreground leading-relaxed","data-testid":"text-bio",children:s!=null&&s.bio?s.bio:e.jsx("span",{className:"italic opacity-70",children:"Share your research journey, expertise, and what drives your work. Highlight your key contributions and areas of specialization to help collaborators and students discover your profile."})})})})})}),(t==null?void 0:t.profileSections)&&t.profileSections.length>0&&e.jsx(Kt,{sections:t.profileSections}),e.jsx($,{id:"timeline",title:"Research Journey",icon:e.jsx(Z,{className:"w-5 h-5 md:w-6 md:h-6"}),defaultOpen:!0,mobileDefaultOpen:!1,className:"bg-muted/30",children:e.jsx(Gt,{openalexId:p,researcherData:t,inline:!0})}),e.jsx($,{id:"analytics",title:"Research Impact",icon:e.jsx(ct,{className:"w-5 h-5 md:w-6 md:h-6"}),defaultOpen:!0,mobileDefaultOpen:!1,className:"bg-background",children:e.jsx(vt,{openalexId:p,researcherData:t,inline:!0})}),e.jsx($,{id:"research",title:"Research Areas",icon:e.jsx(Ne,{className:"w-5 h-5 md:w-6 md:h-6"}),defaultOpen:!0,mobileDefaultOpen:!1,className:"bg-muted/30",children:e.jsx(Nt,{openalexId:p,inline:!0})}),e.jsx($,{id:"publications",title:"Publications",icon:e.jsx(Y,{className:"w-5 h-5 md:w-6 md:h-6"}),defaultOpen:!0,mobileDefaultOpen:!1,className:"bg-background",children:e.jsx(Ct,{openalexId:p,inline:!0})}),e.jsx("footer",{className:"bg-muted/30 border-t border-border py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("p",{className:"text-muted-foreground/70 text-sm",children:["¬© ",new Date().getFullYear()," Scholar.name. All rights reserved."]}),(t==null?void 0:t.lastSynced)&&e.jsxs("p",{className:"text-xs text-muted-foreground/60",children:["Last data sync: ",new Date(t.lastSynced).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})})}),(t==null?void 0:t.isPreview)&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-primary shadow-lg border-t border-primary/20 md:block hidden","data-testid":"banner-claim-profile",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsxs("p",{className:"text-white text-sm md:text-base font-medium",children:[e.jsx("span",{className:"hidden lg:inline",children:"This is a preview of what your profile could look like."}),e.jsx("span",{className:"lg:hidden",children:"Preview mode"})," ","Create yours at ",e.jsxs("span",{className:"font-semibold",children:[((s==null?void 0:s.displayName)||(r==null?void 0:r.display_name)||"yourname").toLowerCase().replace(/\s+/g,""),".scholar.name"]})]})]}),e.jsx(P,{onClick:()=>o("/signup"),className:"bg-white text-primary hover:bg-white/90 font-semibold px-6 py-2 rounded-lg shadow-md hover:shadow-lg transition-all","data-testid":"button-claim-profile",children:"Claim This Profile"})]})})}),(t==null?void 0:t.isPreview)&&e.jsx("div",{className:"fixed bottom-[72px] left-0 right-0 z-40 bg-primary shadow-lg border-t border-primary/20 md:hidden","data-testid":"banner-claim-profile-mobile",style:{paddingBottom:"0"},children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col gap-2 text-center",children:[e.jsx("p",{className:"text-white text-sm font-medium",children:"Like what you see? Create your own portfolio!"}),e.jsx(P,{onClick:()=>o("/signup"),className:"bg-white text-primary hover:bg-white/90 font-semibold px-6 py-2 rounded-lg shadow-md w-full","data-testid":"button-claim-profile-mobile",children:"Claim & Customize"})]})})}),e.jsx(kt,{}),e.jsx(ms,{isPreview:t==null?void 0:t.isPreview})]})}function Vs(){return ye(),e.jsx(Tt,{initialThemeId:null,children:e.jsx(js,{})})}export{Vs as default};
