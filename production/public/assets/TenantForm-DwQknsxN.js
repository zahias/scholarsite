import{u as Y,a6 as Z,a as ee,r as b,b as se,j as e,L as te,e as c,k as T,C as g,f as v,g as f,h as y,d as j,I as l,G as z,B as ae,_ as d,V as m}from"./index-DsMkGSNQ.js";import{u as ie,t as ne,F as re,a as C,b as S,c as E,d as P,e as F,z as i}from"./form-DwDJHa6e.js";import{u as h}from"./useMutation-BIiySL2y.js";import{T as le}from"./textarea-jlxMfcOq.js";import{S as oe,a as ce,b as de,c as me,d as D}from"./select-Bw0sBznx.js";import{S as he}from"./separator-MX7n0DGa.js";import{A as ue}from"./arrow-left-VC8VMkdm.js";import{S as H}from"./save-COP9v4K5.js";import{T as xe}from"./trash-2-CY__9cR9.js";import{P as G}from"./plus-BzkEBtE6.js";import{U as pe}from"./user-CON3jPQo.js";import{C as ge}from"./circle-check-big-DF4jmYxg.js";import"./label-DBXjDKEQ.js";import"./index-CwynGiMj.js";import"./Combination-CJn4SfTu.js";import"./index-DCOyCOZG.js";const je=i.object({name:i.string().min(1,"Name is required"),plan:i.enum(["starter","professional","institution"]),contactEmail:i.string().email().optional().or(i.literal("")),primaryColor:i.string().optional(),accentColor:i.string().optional(),notes:i.string().optional()});i.object({hostname:i.string().min(1,"Domain is required"),isPrimary:i.boolean().default(!1),isSubdomain:i.boolean().default(!1)});i.object({email:i.string().email("Invalid email"),password:i.string().min(8,"Password must be at least 8 characters"),firstName:i.string().min(1,"First name is required"),lastName:i.string().min(1,"Last name is required")});function Oe(){var U,V;const[,J]=Y(),[,u]=Z("/admin/tenants/:id"),{toast:n}=ee(),o=(u==null?void 0:u.id)==="new",r=o?null:u==null?void 0:u.id,[w,q]=b.useState(""),[a,p]=b.useState({email:"",password:"",firstName:"",lastName:""}),[O,$]=b.useState(""),{data:A,isLoading:_}=se({queryKey:["/api/admin/tenants",r],enabled:!!r}),t=A==null?void 0:A.tenant,x=ie({resolver:ne(je),defaultValues:{name:"",plan:"starter",contactEmail:"",primaryColor:"#0B1F3A",accentColor:"#F2994A",notes:""},values:t?{name:t.name,plan:t.plan,contactEmail:t.contactEmail||"",primaryColor:t.primaryColor||"#0B1F3A",accentColor:t.accentColor||"#F2994A",notes:t.notes||""}:void 0}),k=h({mutationFn:async s=>(await d("POST","/api/admin/tenants",s)).json(),onSuccess:s=>{n({title:"Success",description:"Customer created successfully"}),m.invalidateQueries({queryKey:["/api/admin/tenants"]}),J(`/admin/tenants/${s.tenant.id}`)},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),L=h({mutationFn:async s=>(await d("PATCH",`/api/admin/tenants/${r}`,s)).json(),onSuccess:()=>{n({title:"Success",description:"Customer updated successfully"}),m.invalidateQueries({queryKey:["/api/admin/tenants"]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),M=h({mutationFn:async s=>{var R;return(await d("POST",`/api/admin/tenants/${r}/domains`,{hostname:s,isPrimary:!((R=t==null?void 0:t.domains)!=null&&R.length),isSubdomain:s.includes("scholarname")})).json()},onSuccess:()=>{n({title:"Success",description:"Domain added"}),q(""),m.invalidateQueries({queryKey:["/api/admin/tenants",r]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),W=h({mutationFn:async s=>{await d("DELETE",`/api/admin/tenants/${r}/domains/${s}`)},onSuccess:()=>{n({title:"Success",description:"Domain removed"}),m.invalidateQueries({queryKey:["/api/admin/tenants",r]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),B=h({mutationFn:async s=>(await d("POST",`/api/admin/tenants/${r}/users`,s)).json(),onSuccess:()=>{n({title:"Success",description:"User created"}),p({email:"",password:"",firstName:"",lastName:""}),m.invalidateQueries({queryKey:["/api/admin/tenants",r]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),K=h({mutationFn:async()=>(await d("POST",`/api/admin/tenants/${r}/activate`)).json(),onSuccess:()=>{n({title:"Success",description:"Customer activated!"}),m.invalidateQueries({queryKey:["/api/admin/tenants"]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),Q=h({mutationFn:async s=>(await d("PATCH",`/api/admin/tenants/${r}/profile`,{openalexId:s||null})).json(),onSuccess:()=>{n({title:"Success",description:"OpenAlex ID updated"}),m.invalidateQueries({queryKey:["/api/admin/tenants",r]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),I=((U=t==null?void 0:t.profile)==null?void 0:U.openalexId)||"";b.useEffect(()=>{I&&$(I)},[I]);const X=s=>{o?k.mutate(s):L.mutate(s)};return!o&&_?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 w-48 bg-white/5 rounded"}),e.jsx("div",{className:"h-96 bg-white/5 rounded"})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(te,{href:"/admin",children:e.jsx(c,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-white",children:e.jsx(ue,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:o?"New Customer":t==null?void 0:t.name}),!o&&t&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(T,{className:t.status==="active"?"bg-green-500/20 text-green-300":t.status==="pending"?"bg-yellow-500/20 text-yellow-300":"bg-slate-500/20 text-slate-300",children:t.status}),e.jsx(T,{className:"bg-purple-500/20 text-purple-300",children:t.plan})]})]})]}),e.jsxs(g,{className:"bg-white/5 border-white/10",children:[e.jsxs(v,{children:[e.jsx(f,{className:"text-white",children:"Customer Details"}),e.jsx(y,{className:"text-slate-400",children:"Basic information about this customer site"})]}),e.jsx(j,{children:e.jsx(re,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(X),className:"space-y-4",children:[e.jsx(C,{control:x.control,name:"name",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{className:"text-slate-300",children:"Site Name"}),e.jsx(P,{children:e.jsx(l,{...s,placeholder:"Dr. John Smith Portfolio",className:"bg-white/5 border-white/10 text-white","data-testid":"input-name"})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(C,{control:x.control,name:"plan",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{className:"text-slate-300",children:"Plan"}),e.jsxs(oe,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(P,{children:e.jsx(ce,{className:"bg-white/5 border-white/10 text-white",children:e.jsx(de,{placeholder:"Select plan"})})}),e.jsxs(me,{children:[e.jsx(D,{value:"starter",children:"Starter ($9/mo)"}),e.jsx(D,{value:"professional",children:"Professional ($19/mo)"}),e.jsx(D,{value:"institution",children:"Institution ($49/mo)"})]})]}),e.jsx(F,{})]})}),e.jsx(C,{control:x.control,name:"contactEmail",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{className:"text-slate-300",children:"Contact Email"}),e.jsx(P,{children:e.jsx(l,{...s,type:"email",placeholder:"contact@example.com",className:"bg-white/5 border-white/10 text-white","data-testid":"input-contact-email"})}),e.jsx(F,{})]})})]}),e.jsx(C,{control:x.control,name:"notes",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{className:"text-slate-300",children:"Notes"}),e.jsx(P,{children:e.jsx(le,{...s,placeholder:"Internal notes about this customer...",className:"bg-white/5 border-white/10 text-white min-h-[80px]","data-testid":"input-notes"})}),e.jsx(F,{})]})}),e.jsxs(c,{type:"submit",className:"bg-orange-500 hover:bg-orange-600",disabled:k.isPending||L.isPending,"data-testid":"button-save",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),o?"Create Customer":"Save Changes"]})]})})})]}),!o&&t&&e.jsxs(e.Fragment,{children:[e.jsxs(g,{className:"bg-white/5 border-white/10",children:[e.jsxs(v,{children:[e.jsxs(f,{className:"text-white flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Domains"]}),e.jsx(y,{className:"text-slate-400",children:"Custom domains for this customer's site"})]}),e.jsxs(j,{className:"space-y-4",children:[t.domains.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-white",children:s.hostname}),s.isPrimary&&e.jsx(T,{className:"bg-green-500/20 text-green-300",children:"Primary"})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>W.mutate(s.id),className:"text-red-400 hover:text-red-300 hover:bg-red-500/10","data-testid":`button-delete-domain-${s.id}`,children:e.jsx(xe,{className:"w-4 h-4"})})]},s.id)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{value:w,onChange:s=>q(s.target.value),placeholder:"drsmith.scholarname.com or dr-smith.com",className:"bg-white/5 border-white/10 text-white","data-testid":"input-new-domain"}),e.jsxs(c,{onClick:()=>w&&M.mutate(w),disabled:!w||M.isPending,className:"bg-blue-500 hover:bg-blue-600","data-testid":"button-add-domain",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Add"]})]})]})]}),e.jsxs(g,{className:"bg-white/5 border-white/10",children:[e.jsxs(v,{children:[e.jsxs(f,{className:"text-white flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Users"]}),e.jsx(y,{className:"text-slate-400",children:"Login credentials for this customer"})]}),e.jsxs(j,{className:"space-y-4",children:[t.users.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-white",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-slate-400",children:s.email})]})},s.id)),e.jsx(he,{className:"bg-white/10"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{value:a.firstName,onChange:s=>p({...a,firstName:s.target.value}),placeholder:"First name",className:"bg-white/5 border-white/10 text-white","data-testid":"input-new-user-firstname"}),e.jsx(l,{value:a.lastName,onChange:s=>p({...a,lastName:s.target.value}),placeholder:"Last name",className:"bg-white/5 border-white/10 text-white","data-testid":"input-new-user-lastname"}),e.jsx(l,{value:a.email,onChange:s=>p({...a,email:s.target.value}),type:"email",placeholder:"Email",className:"bg-white/5 border-white/10 text-white","data-testid":"input-new-user-email"}),e.jsx(l,{value:a.password,onChange:s=>p({...a,password:s.target.value}),type:"password",placeholder:"Password (min 8 chars)",className:"bg-white/5 border-white/10 text-white","data-testid":"input-new-user-password"})]}),e.jsxs(c,{onClick:()=>a.email&&a.password&&a.firstName&&a.lastName&&B.mutate(a),disabled:!a.email||!a.password||!a.firstName||!a.lastName||B.isPending,className:"bg-blue-500 hover:bg-blue-600","data-testid":"button-add-user",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Add User"]})]})]}),e.jsxs(g,{className:"bg-white/5 border-white/10",children:[e.jsxs(v,{children:[e.jsxs(f,{className:"text-white flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"OpenAlex Profile"]}),e.jsx(y,{className:"text-slate-400",children:"Link this customer to their OpenAlex researcher profile"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white/5 rounded-lg",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Current:"}),e.jsx("span",{className:"text-white font-mono",children:((V=t.profile)==null?void 0:V.openalexId)||"Not set"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{value:O,onChange:s=>$(s.target.value),placeholder:"A1234567890 (OpenAlex Author ID)",className:"bg-white/5 border-white/10 text-white font-mono","data-testid":"input-openalexid"}),e.jsxs(c,{onClick:()=>Q.mutate(O),disabled:Q.isPending,className:"bg-purple-500 hover:bg-purple-600","data-testid":"button-update-openalexid",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Save"]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:'Find the OpenAlex ID by searching on openalex.org. The ID starts with "A" followed by numbers.'})]})]}),t.status==="pending"&&e.jsx(g,{className:"bg-green-500/10 border-green-500/20",children:e.jsx(j,{className:"py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to activate?"}),e.jsx("p",{className:"text-slate-400",children:"Make sure you've added at least one domain and one user."})]}),e.jsxs(c,{onClick:()=>K.mutate(),disabled:t.domains.length===0||t.users.length===0||K.isPending,className:"bg-green-500 hover:bg-green-600","data-testid":"button-activate",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Activate Customer"]})]})})})]})]})})}export{Oe as default};
