import{u as Z,a as ee,r as t,b as se,j as e,l as O,C as S,d as C,Q as k,m as Q,e as F,f as $,g as q,h as D,I as i,A as M,ai as te,a5 as U,B as ae}from"./index-DsMkGSNQ.js";import{u as re}from"./useMutation-BIiySL2y.js";import{u as ne,F as oe,a as m,b as x,c as u,d as h,e as f,z as c,t as le}from"./form-DwDJHa6e.js";import{C as z}from"./circle-check-big-DF4jmYxg.js";import{A as ie}from"./arrow-left-VC8VMkdm.js";import{U as ce}from"./user-CON3jPQo.js";import{a as de,E as me}from"./eye-DWE8iN3r.js";import{E as xe}from"./external-link-By5JbUa5.js";import"./label-DBXjDKEQ.js";const ue=c.object({firstName:c.string().min(1,"First name is required"),lastName:c.string().min(1,"Last name is required"),email:c.string().email("Please enter a valid email address"),password:c.string().min(8,"Password must be at least 8 characters"),affiliation:c.string().optional()});function ve(){var B;const[,E]=Z(),{toast:L}=ee(),[l,P]=t.useState(1),p=3,[y,V]=t.useState(!1),[w,A]=t.useState(""),[d,G]=t.useState(""),[H,j]=t.useState(!1),[a,T]=t.useState(null),b=t.useRef(null),[v,J]=t.useState(!1);t.useEffect(()=>{window.scrollTo(0,0)},[]);const n=ne({resolver:le(ue),defaultValues:{firstName:"",lastName:"",email:"",password:"",affiliation:""}});t.useEffect(()=>{const s=setTimeout(()=>G(w),300);return()=>clearTimeout(s)},[w]),t.useEffect(()=>{const s=o=>{b.current&&!b.current.contains(o.target)&&j(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const{data:g,isLoading:W}=se({queryKey:["/api/openalex/autocomplete",d],queryFn:async()=>{const s=await fetch(`/api/openalex/autocomplete?q=${encodeURIComponent(d)}`);if(!s.ok)throw new Error("Search failed");return s.json()},enabled:d.length>=2}),N=re({mutationFn:async s=>{const o=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:s.firstName,lastName:s.lastName,email:s.email,password:s.password,openalexId:s.openalexId,affiliation:s.affiliation})});if(!o.ok){const r=await o.json();throw new Error(r.message||"Signup failed")}return o.json()},onSuccess:()=>{J(!0),L({title:"Account created!",description:"Welcome to Scholar.name. Redirecting to your dashboard…"}),setTimeout(()=>E("/dashboard"),1500)},onError:s=>{L({title:"Signup failed",description:s.message,variant:"destructive"})}}),Y=async()=>{if(await n.trigger()){const{firstName:o,lastName:r}=n.getValues();A(`${o} ${r}`),P(2),window.scrollTo(0,0)}},I=()=>{const s=n.getValues();N.mutate({...s,openalexId:(a==null?void 0:a.id)||void 0})},K=s=>{T(s),j(!1)},_=()=>e.jsx("div",{className:"flex items-center justify-center gap-2 mb-8",children:Array.from({length:p},(s,o)=>{const r=o+1,X=r===l,R=r<l||v;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold transition-colors ${R?"bg-green-600 text-white":X?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"}`,children:R?e.jsx(z,{className:"w-4 h-4"}):r}),r<p&&e.jsx("div",{className:`w-10 h-0.5 ${r<l||v?"bg-green-600":"bg-muted"}`})]},r)})});return v?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(O,{mode:"auth"}),e.jsxs("div",{className:"flex-1 max-w-md mx-auto w-full px-4 py-16",children:[e.jsx(_,{}),e.jsx(S,{children:e.jsxs(C,{className:"pt-12 pb-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6",children:e.jsx(z,{className:"w-8 h-8 text-green-600"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Welcome to Scholar.name!"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Your account has been created. Redirecting to your dashboard..."}),e.jsx(k,{className:"w-6 h-6 animate-spin mx-auto text-primary"})]})})]}),e.jsx(Q,{mode:"landing"})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(O,{mode:"auth"}),e.jsxs("div",{className:"flex-1 max-w-md mx-auto w-full px-4 py-12",children:[e.jsxs(F,{variant:"ghost",className:"mb-4",onClick:()=>{l===1?E("/"):P(l-1)},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),l===1?"Back to Home":"Back"]}),e.jsx(_,{}),l===1&&e.jsxs(S,{children:[e.jsxs($,{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(ce,{className:"w-6 h-6 text-primary"})}),e.jsx(q,{className:"text-2xl",children:"Create your account"}),e.jsxs(D,{children:["Step 1 of ",p," — your login details"]})]}),e.jsx(C,{children:e.jsx(oe,{...n,children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),Y()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:n.control,name:"firstName",render:({field:s})=>e.jsxs(x,{children:[e.jsx(u,{children:"First name"}),e.jsx(h,{children:e.jsx(i,{placeholder:"Jane",autoComplete:"given-name",...s})}),e.jsx(f,{})]})}),e.jsx(m,{control:n.control,name:"lastName",render:({field:s})=>e.jsxs(x,{children:[e.jsx(u,{children:"Last name"}),e.jsx(h,{children:e.jsx(i,{placeholder:"Smith",autoComplete:"family-name",...s})}),e.jsx(f,{})]})})]}),e.jsx(m,{control:n.control,name:"email",render:({field:s})=>e.jsxs(x,{children:[e.jsx(u,{children:"Email"}),e.jsx(h,{children:e.jsx(i,{type:"email",placeholder:"jane.smith@university.edu",autoComplete:"email",...s})}),e.jsx(f,{})]})}),e.jsx(m,{control:n.control,name:"password",render:({field:s})=>e.jsxs(x,{children:[e.jsx(u,{children:"Password"}),e.jsx(h,{children:e.jsxs("div",{className:"relative",children:[e.jsx(i,{type:y?"text":"password",placeholder:"Enter your password",autoComplete:"new-password",...s}),e.jsx("button",{type:"button",onClick:()=>V(!y),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:y?e.jsx(de,{className:"w-4 h-4"}):e.jsx(me,{className:"w-4 h-4"})})]})}),e.jsx(f,{})]})}),e.jsx(m,{control:n.control,name:"affiliation",render:({field:s})=>e.jsxs(x,{children:[e.jsxs(u,{children:["Affiliation ",e.jsx("span",{className:"text-muted-foreground font-normal",children:"(optional)"})]}),e.jsx(h,{children:e.jsx(i,{placeholder:"e.g., MIT, Stanford University",autoComplete:"organization",...s})}),e.jsx(f,{})]})}),e.jsxs(F,{type:"submit",className:"w-full btn-premium py-6",children:["Continue",e.jsx(M,{className:"w-4 h-4 ml-2"})]})]})})}),e.jsx(te,{className:"flex flex-col gap-4 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["By continuing, you agree to our"," ",e.jsx("a",{href:"/terms",className:"text-primary hover:underline",children:"Terms"})," ","and"," ",e.jsx("a",{href:"/privacy",className:"text-primary hover:underline",children:"Privacy Policy"}),"."]})})]}),l===2&&e.jsxs(S,{children:[e.jsxs($,{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"w-6 h-6 text-primary"})}),e.jsx(q,{className:"text-2xl",children:"Find your research profile"}),e.jsxs(D,{children:["Step 2 of ",p," — link your OpenAlex publications (optional)"]})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"relative",ref:b,children:[e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(i,{type:"text",placeholder:"Search by name...",value:w,onChange:s=>{A(s.target.value),j(!0),T(null)},onFocus:()=>j(!0),className:"pl-10"})]}),H&&d.length>=2&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-card border rounded-lg shadow-lg max-h-64 overflow-y-auto",children:W?e.jsxs("div",{className:"p-4 flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(k,{className:"w-4 h-4 animate-spin"}),"Searching..."]}):(B=g==null?void 0:g.results)!=null&&B.length?g.results.map(s=>e.jsxs("button",{className:"w-full text-left px-4 py-3 hover:bg-muted/50 transition-colors border-b last:border-b-0",onClick:()=>K(s),children:[e.jsx("p",{className:"font-medium text-sm",children:s.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.hint}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[s.works_count.toLocaleString()," works ·"," ",s.cited_by_count.toLocaleString()," citations"]})]},s.id)):e.jsxs("div",{className:"p-4 text-sm text-muted-foreground text-center",children:["No researchers found for “",d,"”"]})})]}),a&&e.jsx("div",{className:"border rounded-lg p-4 bg-muted/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold",children:a.display_name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.hint}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.works_count.toLocaleString()," works"]}),e.jsxs("span",{children:[a.cited_by_count.toLocaleString()," citations"]})]})]}),e.jsx("a",{href:`/researcher/${a.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 flex-shrink-0",title:"Preview profile",children:e.jsx(xe,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(F,{className:"w-full btn-premium py-6",onClick:I,disabled:N.isPending,children:N.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating account..."]}):e.jsxs(e.Fragment,{children:["Create Your Portfolio",e.jsx(M,{className:"w-4 h-4 ml-2"})]})}),!a&&e.jsx("button",{type:"button",className:"w-full text-sm text-muted-foreground hover:text-foreground transition-colors",onClick:I,disabled:N.isPending,children:"Skip — I'll add this later"})]})]})]}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-6",children:["Already have an account?"," ",e.jsx("a",{href:"/login",className:"text-primary hover:underline font-medium",children:"Log in"})]})]}),e.jsx(Q,{mode:"landing"})]})}export{ve as default};
