import{u as P,b as p,j as e}from"./vendor-query-CD7Z7DR7.js";import{r}from"./vendor-react-DHpf67ko.js";import{c as O,i as Es,j as As,p as L,r as ye,B as d,C as x,l as j,m as f,a1 as as,n as y,k as h,I as g,a3 as rs,t as Is,q as T,R as be,F as E,v as Ls,V as is,s as Ms,W as N,Q as u}from"./index-CSSeCMaq.js";import{T as ls}from"./textarea-DKZXgL1-.js";import{T as Os,a as $s,b as D,c as G,Q as qs}from"./tabs-IbKxjgrJ.js";import{S as re}from"./skeleton-7ha_c0n9.js";import{S as ie}from"./separator-DorR-l4F.js";import{L as o}from"./label-Bd5zOz9s.js";import{E as M}from"./external-link-DcJ7BC5F.js";import{L as Rs,C as Qs,S as Vs}from"./settings-CwU0gr5z.js";import{C as ns}from"./circle-check-big-ljVw1W3U.js";import{A as _s}from"./award-Dj0JS51N.js";import{U as os}from"./user-VFcOUBMa.js";import{S as cs}from"./save-BRXXNaFw.js";import{S as ds}from"./star-DFvTMCRJ.js";import{T as Ne}from"./trash-2-Cipkkdai.js";import{P as Ks}from"./plus-mXCGSd4T.js";import{E as le,a as ne}from"./eye-BZcpANvC.js";import{C as Ys}from"./circle-x-Po_eRUeJ.js";import{C as ms}from"./clock-DcElj5gi.js";import{P as zs}from"./palette-BahJgB7V.js";import{D as Ds}from"./download-CVwdhaLj.js";import"./vendor-charts-4dyn6-nb.js";import"./index-Du9YQ6ig.js";import"./index-BK9eCt_v.js";import"./index-B1CoDt99.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=O("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=O("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=O("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=O("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=O("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=O("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Xs={displayName:"",title:"",bio:"",websiteUrl:"",twitterUrl:"",linkedinUrl:"",googleScholarUrl:"",orcidUrl:"",researchGateUrl:""};function Pt(){var Qe,Ve,_e,Ke,Ye,ze,De,Ge,He,Be,We,Xe,Je,Ze,es,ss,ts;const[,Ce]=Es(),{toast:a}=As(),[c,Se]=r.useState(Xs),v=r.useCallback((s,t)=>Se(i=>({...i,[s]:t})),[]),[Js,Pe]=r.useState(""),[ke,Fe]=r.useState(!1),[$,xs]=r.useState("profile"),oe=r.useRef(null),[ce,Ue]=r.useState(""),[q,hs]=r.useState(""),[us,H]=r.useState(!1),[k,de]=r.useState(null),me=r.useRef(null),Te=r.useRef(null),[xe,he]=r.useState(!0),[ps,ue]=r.useState(null),[B,Ee]=r.useState(""),[A,Ae]=r.useState(""),[W,Ie]=r.useState(""),[X,gs]=r.useState(!1),[J,js]=r.useState(!1),[pe,ge]=r.useState(null),[R,Q]=r.useState(""),[V,_]=r.useState(""),[Le,Z]=r.useState("custom"),{data:F,isLoading:fs}=P({queryKey:["/api/auth/me"]}),{data:l,isLoading:ys}=P({queryKey:["/api/researcher/my-tenant"],enabled:!!(F!=null&&F.user)}),{data:w,refetch:Me}=P({queryKey:["/api/openalex/author",(Ve=(Qe=l==null?void 0:l.tenant)==null?void 0:Qe.profile)==null?void 0:Ve.openalexId],enabled:!!((Ke=(_e=l==null?void 0:l.tenant)==null?void 0:_e.profile)!=null&&Ke.openalexId)}),{data:K}=P({queryKey:["/api/themes"],enabled:$==="settings"}),{data:I}=P({queryKey:["/api/researcher/publications"],enabled:!!((ze=(Ye=l==null?void 0:l.tenant)==null?void 0:Ye.profile)!=null&&ze.openalexId)&&$==="publications"}),{data:ee}=P({queryKey:["/api/researcher/sections"],enabled:!!((De=l==null?void 0:l.tenant)!=null&&De.profile)&&$==="sections"}),{data:Y,refetch:Zs}=P({queryKey:["/api/researcher/sync-logs"],enabled:!!((Ge=l==null?void 0:l.tenant)!=null&&Ge.profile)&&$==="sync"});r.useEffect(()=>{var s;if((s=l==null?void 0:l.tenant)!=null&&s.profile){const t=l.tenant.profile;Se({displayName:t.displayName||"",title:t.title||"",bio:t.bio||"",websiteUrl:t.websiteUrl||"",twitterUrl:t.twitterUrl||"",linkedinUrl:t.linkedinUrl||"",googleScholarUrl:t.googleScholarUrl||"",orcidUrl:t.orcidUrl||"",researchGateUrl:t.researchGateUrl||""}),Pe(t.openalexId||""),he(t.isPublic!==!1),ue(t.selectedThemeId||null)}},[l]),r.useEffect(()=>{const s=setTimeout(()=>hs(ce),300);return()=>clearTimeout(s)},[ce]),r.useEffect(()=>{const s=t=>{me.current&&!me.current.contains(t.target)&&H(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const{data:se,isLoading:bs}=P({queryKey:["/api/openalex/autocomplete",q],queryFn:async()=>{const s=await fetch(`/api/openalex/autocomplete?q=${encodeURIComponent(q)}`);if(!s.ok)throw new Error("Search failed");return s.json()},enabled:q.length>=2}),Ns=r.useCallback(s=>{de(s),Pe(s.id),Ue(""),H(!1)},[]),vs=p({mutationFn:async()=>{await N("POST","/api/auth/logout")},onSuccess:()=>{u.clear(),Ce("/dashboard/login")}}),U=p({mutationFn:async s=>(await N("PATCH","/api/researcher/profile",s)).json(),onSuccess:()=>{a({title:"Saved!",description:"Your profile has been updated."}),u.invalidateQueries({queryKey:["/api/researcher/my-tenant"]})},onError:s=>{a({title:"Error",description:s.message,variant:"destructive"})}}),b=p({mutationFn:async()=>(await N("POST","/api/researcher/sync")).json(),onSuccess:()=>{a({title:"Synced!",description:"Your profile data has been refreshed from OpenAlex."}),u.invalidateQueries({queryKey:["/api/researcher/my-tenant"]}),u.invalidateQueries({queryKey:["/api/researcher/publications"]}),u.invalidateQueries({queryKey:["/api/researcher/sync-logs"]}),Me()},onError:s=>{a({title:"Sync Failed",description:s.message,variant:"destructive"})}}),je=p({mutationFn:async s=>(await N("PATCH","/api/researcher/profile",{openalexId:s})).json(),onSuccess:()=>{a({title:"Profile Connected!",description:"Your OpenAlex profile has been linked. Syncing publications..."}),de(null),u.invalidateQueries({queryKey:["/api/researcher/my-tenant"]}),Me(),b.mutate()},onError:s=>{a({title:"Connection Failed",description:s.message,variant:"destructive"})}}),z=p({mutationFn:async s=>{const t=new FormData;t.append("photo",s);const i=await fetch("/api/researcher/upload-photo",{method:"POST",body:t,credentials:"include"});if(!i.ok){const C=await i.json();throw new Error(C.message||"Failed to upload photo")}return i.json()},onSuccess:()=>{a({title:"Photo Updated!",description:"Your profile photo has been uploaded."}),u.invalidateQueries({queryKey:["/api/researcher/my-tenant"]})},onError:s=>{a({title:"Upload Failed",description:s.message,variant:"destructive"})}}),te=p({mutationFn:async s=>{const t=new FormData;t.append("cv",s);const i=await fetch("/api/researcher/upload-cv",{method:"POST",body:t,credentials:"include"});if(!i.ok){const C=await i.json();throw new Error(C.message||"Failed to upload CV")}return i.json()},onSuccess:()=>{a({title:"CV Uploaded!",description:"Your CV has been uploaded successfully."}),u.invalidateQueries({queryKey:["/api/researcher/my-tenant"]})},onError:s=>{a({title:"Upload Failed",description:s.message,variant:"destructive"})}}),Oe=p({mutationFn:async()=>(await N("DELETE","/api/researcher/cv")).json(),onSuccess:()=>{a({title:"CV Removed",description:"Your CV has been removed from your profile."}),u.invalidateQueries({queryKey:["/api/researcher/my-tenant"]})},onError:s=>{a({title:"Error",description:s.message,variant:"destructive"})}}),ae=p({mutationFn:async s=>(await N("PATCH","/api/auth/password",s)).json(),onSuccess:()=>{a({title:"Password Changed!",description:"Your password has been updated successfully."}),Ee(""),Ae(""),Ie("")},onError:s=>{a({title:"Error",description:s.message,variant:"destructive"})}}),$e=p({mutationFn:async({publicationId:s,isFeatured:t})=>(await N("PATCH",`/api/researcher/publications/${s}/feature`,{isFeatured:t})).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/researcher/publications"]})},onError:s=>{a({title:"Error",description:s.message,variant:"destructive"})}}),ws=p({mutationFn:async({publicationId:s,file:t})=>{const i=new FormData;i.append("pdf",t);const C=await fetch(`/api/researcher/publications/${s}/upload-pdf`,{method:"POST",body:i,credentials:"include"});if(!C.ok)throw new Error("Upload failed");return C.json()},onSuccess:()=>{a({title:"PDF uploaded",description:"Publication PDF has been saved."}),u.invalidateQueries({queryKey:["/api/researcher/publications"]})},onError:()=>{a({title:"Error",description:"Failed to upload PDF",variant:"destructive"})}}),qe=p({mutationFn:async s=>{await N("DELETE",`/api/researcher/publications/${s}/pdf`)},onSuccess:()=>{a({title:"PDF removed",description:"Publication PDF has been deleted."}),u.invalidateQueries({queryKey:["/api/researcher/publications"]})},onError:()=>{a({title:"Error",description:"Failed to remove PDF",variant:"destructive"})}}),Re=p({mutationFn:async s=>(await N("POST","/api/researcher/sections",s)).json(),onSuccess:()=>{a({title:"Section Created!",description:"Your new section has been added."}),u.invalidateQueries({queryKey:["/api/researcher/sections"]}),Q(""),_(""),Z("custom")},onError:s=>{a({title:"Error",description:s.message,variant:"destructive"})}}),fe=p({mutationFn:async({id:s,...t})=>(await N("PATCH",`/api/researcher/sections/${s}`,t)).json(),onSuccess:()=>{a({title:"Section Updated!",description:"Your changes have been saved."}),u.invalidateQueries({queryKey:["/api/researcher/sections"]}),ge(null),Q(""),_("")},onError:s=>{a({title:"Error",description:s.message,variant:"destructive"})}}),Cs=p({mutationFn:async s=>(await N("DELETE",`/api/researcher/sections/${s}`)).json(),onSuccess:()=>{a({title:"Section Deleted",description:"The section has been removed."}),u.invalidateQueries({queryKey:["/api/researcher/sections"]})},onError:s=>{a({title:"Error",description:s.message,variant:"destructive"})}}),Ss=r.useCallback(async()=>{Fe(!0);try{await U.mutateAsync({displayName:c.displayName||null,title:c.title||null,bio:c.bio||null,websiteUrl:c.websiteUrl||null,twitterUrl:c.twitterUrl||null,linkedinUrl:c.linkedinUrl||null,googleScholarUrl:c.googleScholarUrl||null,orcidUrl:c.orcidUrl||null,researchGateUrl:c.researchGateUrl||null})}finally{Fe(!1)}},[c,U]),Ps=r.useCallback(s=>{var i;const t=(i=s.target.files)==null?void 0:i[0];if(t){if(t.size>5*1024*1024){a({title:"File too large",description:"Please choose an image under 5MB",variant:"destructive"});return}z.mutate(t)}},[a,z]),ks=r.useCallback(s=>{var i;const t=(i=s.target.files)==null?void 0:i[0];if(t){if(t.size>10*1024*1024){a({title:"File too large",description:"Please choose a document under 10MB",variant:"destructive"});return}te.mutate(t)}},[a,te]),Fs=r.useCallback(()=>{if(A!==W){a({title:"Passwords don't match",description:"New password and confirmation must match",variant:"destructive"});return}if(A.length<8){a({title:"Password too short",description:"Password must be at least 8 characters",variant:"destructive"});return}ae.mutate({currentPassword:B,newPassword:A})},[B,A,W,a,ae]),Us=r.useCallback(async s=>{he(s);try{await U.mutateAsync({isPublic:s})}catch{he(!s)}},[U]),Ts=r.useCallback(async s=>{var t,i;ue(s);try{await U.mutateAsync({selectedThemeId:s})}catch{ue(((i=(t=l==null?void 0:l.tenant)==null?void 0:t.profile)==null?void 0:i.selectedThemeId)||null)}},[U,l]);if(fs||ys)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx(re,{className:"h-20 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(re,{className:"h-32"}),e.jsx(re,{className:"h-32"}),e.jsx(re,{className:"h-32"})]})]})});if(!(F!=null&&F.user))return Ce("/dashboard/login"),null;const m=l==null?void 0:l.tenant,n=m==null?void 0:m.profile,S=((He=m==null?void 0:m.domains)==null?void 0:He.find(s=>s.isPrimary))||((Be=m==null?void 0:m.domains)==null?void 0:Be[0]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col",children:[e.jsx("header",{className:"border-b bg-white sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary rounded-xl flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"My Portfolio"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Welcome, ",F.user.firstName]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[S&&e.jsxs("a",{href:`https://${S.hostname}`,target:"_blank",rel:"noopener noreferrer",className:"hidden md:flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),S.hostname,e.jsx(M,{className:"w-3 h-3"})]}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>vs.mutate(),className:"text-muted-foreground hover:text-foreground","data-testid":"button-logout",children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})]})}),e.jsxs("main",{className:"flex-1 max-w-5xl mx-auto w-full px-4 py-8 space-y-8",children:[n!=null&&n.openalexId?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Publications"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:((Xe=w==null?void 0:w.works_count)==null?void 0:Xe.toLocaleString())||"—"})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Citations"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:((Je=w==null?void 0:w.cited_by_count)==null?void 0:Je.toLocaleString())||"—"})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Is,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:(m==null?void 0:m.status)==="active"?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-lg font-medium text-green-600",children:"Live"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Qs,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"text-lg font-medium text-yellow-600",children:"Pending"})]})})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(_s,{className:"w-6 h-6 text-purple-600"})})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(T,{className:"bg-slate-100 text-slate-700 hover:bg-slate-100",children:["OpenAlex: ",n.openalexId]}),n.lastSyncedAt&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last synced:"," ",new Date(n.lastSyncedAt).toLocaleDateString()]})]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>b.mutate(),disabled:b.isPending,"data-testid":"button-sync",children:[e.jsx(be,{className:`w-4 h-4 mr-2 ${b.isPending?"animate-spin":""}`}),"Refresh Data"]})]})]}):e.jsxs(x,{className:"border-orange-200 bg-orange-50",children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2 text-orange-800",children:[e.jsx(as,{className:"w-5 h-5"}),"Connect Your OpenAlex Profile"]}),e.jsx(y,{className:"text-orange-700",children:"Search for your name to find and connect your OpenAlex author profile. This will import your publications, citations, and research topics automatically."})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",ref:me,children:[e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-orange-400 w-4 h-4"}),e.jsx(g,{type:"text",placeholder:"Search by name...",value:ce,onChange:s=>{Ue(s.target.value),H(!0),de(null)},onFocus:()=>H(!0),className:"pl-10","data-testid":"input-openalex-search"})]}),us&&q.length>=2&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-card border rounded-lg shadow-lg max-h-64 overflow-y-auto",children:bs?e.jsxs("div",{className:"p-4 flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(rs,{className:"w-4 h-4 animate-spin"}),"Searching..."]}):(We=se==null?void 0:se.results)!=null&&We.length?se.results.map(s=>e.jsxs("button",{className:"w-full text-left px-4 py-3 hover:bg-muted/50 transition-colors border-b last:border-b-0",onClick:()=>Ns(s),children:[e.jsx("p",{className:"font-medium text-sm",children:s.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.hint}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[s.works_count.toLocaleString()," works ·"," ",s.cited_by_count.toLocaleString()," citations"]})]},s.id)):e.jsxs("div",{className:"p-4 text-sm text-muted-foreground text-center",children:["No researchers found for “",q,"”"]})})]}),k&&e.jsx("div",{className:"border rounded-lg p-4 bg-white",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(L,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold",children:k.display_name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:k.hint}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[k.works_count.toLocaleString()," works"]}),e.jsxs("span",{children:[k.cited_by_count.toLocaleString()," citations"]})]})]}),e.jsx(d,{onClick:()=>je.mutate(k.id),disabled:je.isPending,className:"bg-orange-500 hover:bg-orange-600 flex-shrink-0","data-testid":"button-connect-openalex",children:je.isPending?e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4 mr-2 animate-spin"}),"Connecting..."]}):"Connect"})]})}),!k&&e.jsx("p",{className:"text-sm text-orange-600",children:"Type your name above to search OpenAlex's database of researchers and their publications."})]})]}),e.jsxs(Os,{value:$,onValueChange:xs,className:"w-full",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:e.jsxs($s,{className:"inline-flex w-auto min-w-full sm:grid sm:grid-cols-5 sm:w-[650px] h-auto p-1",children:[e.jsxs(D,{value:"profile","data-testid":"tab-profile",className:"flex-shrink-0 text-xs sm:text-sm",children:[e.jsx(os,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Profile"})]}),e.jsxs(D,{value:"publications","data-testid":"tab-publications",className:"flex-shrink-0 text-xs sm:text-sm",children:[e.jsx(L,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Publications"})]}),e.jsxs(D,{value:"sections","data-testid":"tab-sections",className:"flex-shrink-0 text-xs sm:text-sm",children:[e.jsx(E,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sections"})]}),e.jsxs(D,{value:"sync","data-testid":"tab-sync",className:"flex-shrink-0 text-xs sm:text-sm",children:[e.jsx(ve,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sync"})]}),e.jsxs(D,{value:"settings","data-testid":"tab-settings",className:"flex-shrink-0 text-xs sm:text-sm",children:[e.jsx(Vs,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Settings"})]})]})}),e.jsxs(G,{value:"profile",className:"mt-6 space-y-6",children:[e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(f,{children:"Profile Photo"}),e.jsx(y,{children:"Upload a professional photo to personalize your portfolio"})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[n!=null&&n.profileImageUrl?e.jsx("img",{src:n.profileImageUrl,alt:"Your profile photo",className:"w-24 h-24 rounded-full object-cover border-4 border-slate-100"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary flex items-center justify-center",children:e.jsx(os,{className:"w-10 h-10 text-white"})}),e.jsx("button",{onClick:()=>{var s;return(s=oe.current)==null?void 0:s.click()},disabled:z.isPending,className:"absolute bottom-0 right-0 w-8 h-8 bg-white rounded-full shadow-lg flex items-center justify-center border border-slate-200 hover:bg-slate-50 transition-colors","aria-label":"Change profile photo","data-testid":"button-change-photo",children:e.jsx(Gs,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:oe,type:"file",accept:"image/*",onChange:Ps,className:"hidden","aria-label":"Upload profile photo","data-testid":"input-photo-file"}),e.jsxs(d,{variant:"outline",onClick:()=>{var s;return(s=oe.current)==null?void 0:s.click()},disabled:z.isPending,"data-testid":"button-upload-photo",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),z.isPending?"Uploading...":"Upload Photo"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"JPG, PNG or GIF. Max 5MB."})]})]})})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(f,{children:"Profile Information"}),e.jsx(y,{children:"Customize how your name and biography appear on your portfolio"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"display-name",children:"Display Name"}),e.jsx(g,{id:"display-name",value:c.displayName,onChange:s=>v("displayName",s.target.value),placeholder:(w==null?void 0:w.display_name)||"Your Name","data-testid":"input-display-name"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Leave blank to use your name from OpenAlex"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"professional-title",children:"Professional Title"}),e.jsx(g,{id:"professional-title",value:c.title,onChange:s=>v("title",s.target.value),placeholder:"e.g., Associate Professor of Computer Science","data-testid":"input-title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"biography",children:"Biography"}),e.jsx(ls,{id:"biography",value:c.bio,onChange:s=>v("bio",s.target.value),placeholder:"Tell visitors about your research interests, background, and achievements...",className:"min-h-[150px]","data-testid":"input-bio"})]})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Social & Academic Links"]}),e.jsx(y,{children:"Add links to your other profiles and websites"})]}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"website-url",children:"Personal Website"}),e.jsx(g,{id:"website-url",value:c.websiteUrl,onChange:s=>v("websiteUrl",s.target.value),placeholder:"https://yourwebsite.com",type:"url","data-testid":"input-website"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"twitter-url",children:"Twitter / X"}),e.jsx(g,{id:"twitter-url",value:c.twitterUrl,onChange:s=>v("twitterUrl",s.target.value),placeholder:"https://twitter.com/yourusername",type:"url","data-testid":"input-twitter"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"linkedin-url",children:"LinkedIn"}),e.jsx(g,{id:"linkedin-url",value:c.linkedinUrl,onChange:s=>v("linkedinUrl",s.target.value),placeholder:"https://linkedin.com/in/yourusername",type:"url","data-testid":"input-linkedin"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"google-scholar-url",children:"Google Scholar"}),e.jsx(g,{id:"google-scholar-url",value:c.googleScholarUrl,onChange:s=>v("googleScholarUrl",s.target.value),placeholder:"https://scholar.google.com/citations?user=...",type:"url","data-testid":"input-google-scholar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"orcid-url",children:"ORCID"}),e.jsx(g,{id:"orcid-url",value:c.orcidUrl,onChange:s=>v("orcidUrl",s.target.value),placeholder:"https://orcid.org/0000-0000-0000-0000",type:"url","data-testid":"input-orcid"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"researchgate-url",children:"ResearchGate"}),e.jsx(g,{id:"researchgate-url",value:c.researchGateUrl,onChange:s=>v("researchGateUrl",s.target.value),placeholder:"https://www.researchgate.net/profile/Your-Name",type:"url","data-testid":"input-researchgate"})]})]})})]}),e.jsxs(d,{onClick:Ss,disabled:ke,className:"bg-primary hover:bg-primary/90","data-testid":"button-save-profile",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),ke?"Saving...":"Save All Changes"]})]}),e.jsx(G,{value:"publications",className:"mt-6 space-y-6",children:e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-yellow-500"}),"Featured Publications"]}),e.jsx(y,{children:"Mark publications as featured to highlight them on your portfolio. Featured publications appear prominently at the top."})]}),e.jsx(h,{children:(es=(Ze=l==null?void 0:l.tenant)==null?void 0:Ze.profile)!=null&&es.openalexId?(ss=I==null?void 0:I.publications)!=null&&ss.length?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground pb-2 border-b",children:[e.jsxs("span",{children:[I.publications.filter(s=>s.isFeatured).length," ","featured"]}),e.jsxs("span",{children:[I.publications.length," total publications"]})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto space-y-2",children:I.publications.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border transition-colors ${s.isFeatured?"bg-yellow-50 border-yellow-200":"bg-white border-slate-200 hover:border-slate-300"}`,children:[e.jsx("button",{onClick:()=>$e.mutate({publicationId:s.id,isFeatured:!s.isFeatured}),className:`mt-1 transition-colors ${s.isFeatured?"text-yellow-500":"text-slate-300 hover:text-yellow-400"}`,disabled:$e.isPending,"aria-pressed":s.isFeatured,"aria-label":s.isFeatured?`Unfeature "${s.title}"`:`Feature "${s.title}"`,children:e.jsx(ds,{className:`w-5 h-5 ${s.isFeatured?"fill-current":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm text-foreground line-clamp-2",children:s.title}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.journal&&e.jsx("span",{children:s.journal}),s.publicationYear&&e.jsxs("span",{children:[" ","· ",s.publicationYear]}),s.citationCount>0&&e.jsxs("span",{children:[" ","· ",s.citationCount," ","citations"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[s.isOpenAccess&&e.jsx(T,{variant:"outline",className:"text-green-600 border-green-300 text-xs",children:"Open Access"}),s.doi&&e.jsxs("a",{href:`https://doi.org/${s.doi}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),"DOI"]}),s.pdfUrl?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("a",{href:s.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-green-600 hover:underline flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),"PDF"]}),e.jsx("button",{onClick:()=>qe.mutate(s.id),disabled:qe.isPending,className:"text-xs text-red-500 hover:text-red-700","aria-label":`Remove PDF for "${s.title}"`,children:e.jsx(Ne,{className:"w-3 h-3"})})]}):e.jsxs("label",{className:"text-xs text-muted-foreground hover:text-blue-600 cursor-pointer flex items-center gap-1",children:[e.jsx(we,{className:"w-3 h-3"}),"Upload PDF",e.jsx("input",{type:"file",accept:".pdf",className:"hidden","aria-label":`Upload PDF for "${s.title}"`,onChange:t=>{var C;const i=(C=t.target.files)==null?void 0:C[0];if(i){if(i.size>10*1024*1024){a({title:"File too large",description:"PDF must be under 10MB",variant:"destructive"});return}ws.mutate({publicationId:s.id,file:i}),t.target.value=""}}})]})]})]})]},s.id))})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No publications found. Try syncing your profile."}),e.jsxs(d,{onClick:()=>b.mutate(),variant:"outline",className:"mt-4",disabled:b.isPending,children:[e.jsx(be,{className:`w-4 h-4 mr-2 ${b.isPending?"animate-spin":""}`}),"Sync Now"]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Connect your OpenAlex ID to manage publications"})]})})]})}),e.jsx(G,{value:"sections",className:"mt-6 space-y-6",children:e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-blue-500"}),"Content Sections"]}),e.jsx(y,{children:"Add custom sections to your portfolio such as Research Interests, Awards, Teaching, or any other content."})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-4 pb-6 border-b",children:[e.jsx("h4",{className:"font-medium text-sm text-foreground",children:pe?"Edit Section":"Add New Section"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"section-title",children:"Section Title"}),e.jsx(g,{id:"section-title",value:R,onChange:s=>Q(s.target.value),placeholder:"e.g., Research Interests, Awards, Teaching"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"section-type",children:"Section Type"}),e.jsxs("select",{id:"section-type",value:Le,onChange:s=>Z(s.target.value),className:"w-full h-10 px-3 rounded-md border border-input bg-background text-sm",children:[e.jsx("option",{value:"custom",children:"Custom"}),e.jsx("option",{value:"research_interests",children:"Research Interests"}),e.jsx("option",{value:"awards",children:"Awards & Honors"}),e.jsx("option",{value:"teaching",children:"Teaching"}),e.jsx("option",{value:"grants",children:"Grants & Funding"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"section-content",children:"Content"}),e.jsx(ls,{id:"section-content",value:V,onChange:s=>_(s.target.value),placeholder:"Enter your content here. You can use markdown for formatting...",className:"min-h-[120px]"})]}),e.jsx("div",{className:"flex gap-2",children:pe?e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:()=>{fe.mutate({id:pe,title:R,content:V})},disabled:!R||!V||fe.isPending,className:"bg-primary hover:bg-primary/90",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Save Changes"]}),e.jsx(d,{variant:"outline",onClick:()=>{ge(null),Q(""),_(""),Z("custom")},children:"Cancel"})]}):e.jsxs(d,{onClick:()=>{Re.mutate({title:R,content:V,sectionType:Le})},disabled:!R||!V||Re.isPending,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Add Section"]})})]}),e.jsxs("div",{className:"pt-6 space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-foreground",children:"Your Sections"}),(ts=ee==null?void 0:ee.sections)!=null&&ts.length?e.jsx("div",{className:"space-y-2",children:ee.sections.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border bg-white border-slate-200",children:[e.jsx(Bs,{className:"w-4 h-4 mt-1 text-muted-foreground"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h5",{className:"font-medium text-foreground",children:s.title}),e.jsx(T,{variant:"outline",className:"text-xs",children:s.sectionType}),!s.isVisible&&e.jsx(T,{variant:"outline",className:"text-xs text-orange-600 border-orange-300",children:"Hidden"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:s.content})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm","aria-label":`Edit "${s.title}"`,onClick:()=>{ge(s.id),Q(s.title),_(s.content),Z(s.sectionType)},children:e.jsx(Ws,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm","aria-label":s.isVisible?`Hide "${s.title}"`:`Show "${s.title}"`,onClick:()=>{fe.mutate({id:s.id,isVisible:!s.isVisible})},children:s.isVisible?e.jsx(le,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50","aria-label":`Delete "${s.title}"`,onClick:()=>{confirm("Are you sure you want to delete this section?")&&Cs.mutate(s.id)},children:e.jsx(Ne,{className:"w-4 h-4"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No custom sections yet. Add one above!"})]})]})]})]})}),e.jsx(G,{value:"sync",className:"mt-6 space-y-6",children:e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"OpenAlex Sync Management"]}),e.jsx(y,{children:"View sync history and manually trigger data synchronization from OpenAlex"})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Sync Publications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetch latest publications and citations from OpenAlex"})]}),e.jsxs(d,{onClick:()=>b.mutate(),disabled:b.isPending,children:[e.jsx(be,{className:`w-4 h-4 mr-2 ${b.isPending?"animate-spin":""}`}),b.isPending?"Syncing...":"Sync Now"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground mb-4",children:"Sync History"}),!(Y!=null&&Y.logs)||Y.logs.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground bg-slate-50 rounded-lg border border-dashed",children:[e.jsx(ve,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No sync history yet"}),e.jsx("p",{className:"text-sm",children:"Click “Sync Now” to fetch your latest publications"})]}):e.jsx("div",{className:"space-y-3",children:Y.logs.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.status==="completed"?"bg-green-50 border-green-200":s.status==="failed"?"bg-red-50 border-red-200":s.status==="in_progress"?"bg-blue-50 border-blue-200":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="completed"&&e.jsx(Hs,{className:"w-5 h-5 text-green-600"}),s.status==="failed"&&e.jsx(Ys,{className:"w-5 h-5 text-red-600"}),s.status==="in_progress"&&e.jsx(ms,{className:"w-5 h-5 text-blue-600 animate-pulse"}),s.status==="pending"&&e.jsx(ms,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-foreground capitalize",children:[s.syncType.replace("_"," ")," ","Sync"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Started:"," ",new Date(s.startedAt).toLocaleString()]})]})]}),e.jsx(T,{variant:"outline",className:`${s.status==="completed"?"text-green-700 border-green-300":s.status==="failed"?"text-red-700 border-red-300":s.status==="in_progress"?"text-blue-700 border-blue-300":"text-slate-700 border-slate-300"}`,children:s.status})]}),s.itemsProcessed!==null&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Processed: ",s.itemsProcessed,s.itemsTotal?` / ${s.itemsTotal}`:""," ","items"]}),s.errorMessage&&e.jsxs("p",{className:"text-sm text-red-600 mt-2",children:["Error: ",s.errorMessage]}),s.completedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Completed:"," ",new Date(s.completedAt).toLocaleString()]})]},s.id))})]})]})]})}),e.jsxs(G,{value:"settings",className:"mt-6 space-y-6",children:[e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[xe?e.jsx(le,{className:"w-5 h-5 text-green-600"}):e.jsx(ne,{className:"w-5 h-5 text-muted-foreground"}),"Profile Visibility"]}),e.jsx(y,{children:"Control who can see your research portfolio"})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-lg border",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{htmlFor:"profile-visibility",className:"text-base font-medium",children:"Public Profile"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:xe?"Your portfolio is visible to everyone on the internet":"Your portfolio is hidden from public view"})]}),e.jsx(Ls,{id:"profile-visibility",checked:xe,onCheckedChange:Us,disabled:U.isPending})]})})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"CV / Resume"]}),e.jsx(y,{children:"Upload your CV to allow visitors to download it from your portfolio"})]}),e.jsx(h,{className:"space-y-4",children:n!=null&&n.cvUrl?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(E,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800",children:"CV Uploaded"}),e.jsx("p",{className:"text-sm text-green-600",children:"Your CV is available for download on your portfolio"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:n.cvUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-3 py-1.5 bg-green-600 text-white rounded-md text-sm font-medium hover:bg-green-700",children:[e.jsx(M,{className:"w-3 h-3"}),"View"]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Oe.mutate(),disabled:Oe.isPending,className:"text-red-600 hover:text-red-700 hover:bg-red-50","aria-label":"Remove CV",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]}):e.jsxs("div",{className:"border-2 border-dashed border-slate-200 rounded-lg p-6 text-center",children:[e.jsx(E,{className:"w-10 h-10 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground mb-3",children:"No CV uploaded yet"}),e.jsx("input",{ref:Te,type:"file",accept:".pdf,.doc,.docx",onChange:ks,className:"hidden","aria-label":"Upload CV file"}),e.jsxs(d,{variant:"outline",onClick:()=>{var s;return(s=Te.current)==null?void 0:s.click()},disabled:te.isPending,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),te.isPending?"Uploading...":"Upload CV"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"PDF, DOC, or DOCX. Max 10MB."})]})})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"w-5 h-5"}),"Portfolio Theme"]}),e.jsx(y,{children:"Choose a color theme for your research portfolio"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:K==null?void 0:K.filter(s=>s.isActive).map(s=>{const t=s.config,i=ps===s.id;return e.jsxs("button",{onClick:()=>Ts(s.id),"aria-pressed":i,"aria-label":`Select ${s.name} theme`,className:`relative p-4 rounded-lg border-2 transition-all ${i?"border-primary bg-primary/5 ring-2 ring-primary/20":"border-slate-200 hover:border-slate-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border border-slate-200",style:{backgroundColor:t.colors.primary}}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-slate-200",style:{backgroundColor:t.colors.accent}})]}),e.jsx("p",{className:"text-sm font-medium text-left",children:s.name}),i&&e.jsx(ns,{className:"absolute top-2 right-2 w-5 h-5 text-primary"})]},s.id)})}),(!K||K.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No themes available. Contact your administrator."})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(f,{children:"Account Settings"}),e.jsx(y,{children:"Manage your account and portfolio settings"})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Preview Portfolio"}),n!=null&&n.openalexId?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsx(M,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-700",children:"See how visitors will view your portfolio"}),e.jsxs("a",{href:`/researcher/${n.openalexId}`,target:"_blank",rel:"noopener noreferrer",className:"ml-auto bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm font-medium hover:bg-blue-700 flex items-center gap-1","data-testid":"link-preview-portfolio",children:["Preview",e.jsx(M,{className:"w-3 h-3"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect your OpenAlex ID to preview your portfolio"})]}),e.jsx(ie,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"QR Code"}),n!=null&&n.openalexId?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-50 rounded-lg border border-purple-100",children:[e.jsx(qs,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-purple-700",children:"Download a QR code linking to your portfolio"}),e.jsxs("a",{href:`/api/researcher/${n.openalexId}/qr-code${S?`?url=https://${S.hostname}`:""}`,download:`${n.displayName||"portfolio"}-qr-code.png`,className:"ml-auto bg-purple-600 text-white px-3 py-1.5 rounded-md text-sm font-medium hover:bg-purple-700 flex items-center gap-1","data-testid":"link-download-qr",children:[e.jsx(Ds,{className:"w-3 h-3"}),"Download QR"]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect your OpenAlex ID to generate a QR code"})]}),e.jsx(ie,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Your Domain"}),S?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-50 rounded-lg",children:[e.jsx(ye,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:S.hostname}),e.jsxs("a",{href:`https://${S.hostname}`,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-blue-600 hover:text-blue-700 flex items-center gap-1 text-sm",children:["Visit Site",e.jsx(M,{className:"w-3 h-3"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your domain will be assigned by the administrator"})]}),e.jsx(ie,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Plan"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-50 rounded-lg",children:[e.jsx(T,{className:"capitalize",children:m==null?void 0:m.plan}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Contact support to change your plan"})]})]}),e.jsx(ie,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"OpenAlex ID"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-50 rounded-lg",children:[e.jsx(T,{variant:"outline",className:"font-mono text-xs",children:(n==null?void 0:n.openalexId)||"Not connected"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"To change your OpenAlex profile, contact support"})]})]})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-5 h-5"}),"Change Password"]}),e.jsx(y,{children:"Update your account password"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"current-password",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"current-password",type:X?"text":"password",value:B,onChange:s=>Ee(s.target.value),placeholder:"Enter current password"}),e.jsx("button",{type:"button",onClick:()=>gs(!X),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground","aria-label":X?"Hide current password":"Show current password",children:X?e.jsx(ne,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"new-password",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"new-password",type:J?"text":"password",value:A,onChange:s=>Ae(s.target.value),placeholder:"Enter new password (min. 8 characters)"}),e.jsx("button",{type:"button",onClick:()=>js(!J),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground","aria-label":J?"Hide new password":"Show new password",children:J?e.jsx(ne,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"confirm-password",children:"Confirm New Password"}),e.jsx(g,{id:"confirm-password",type:"password",value:W,onChange:s=>Ie(s.target.value),placeholder:"Confirm new password"})]}),e.jsxs(d,{onClick:Fs,disabled:!B||!A||!W||ae.isPending,className:"bg-primary hover:bg-primary/90",children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),ae.isPending?"Updating...":"Update Password"]})]})]})]})]})]}),e.jsx(Ms,{mode:"app"})]})}export{Pt as default};
